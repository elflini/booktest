<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Moving Beyond Linearity | Statistical Learning</title>
  <meta name="description" content="This is a Statistical Learning" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Moving Beyond Linearity | Statistical Learning" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a Statistical Learning" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Moving Beyond Linearity | Statistical Learning" />
  
  <meta name="twitter:description" content="This is a Statistical Learning" />
  

<meta name="author" content="Jin Hyun Nam" />


<meta name="date" content="2023-05-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter7.html"/>
<link rel="next" href="chapter9.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Learning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>머리말</a></li>
<li class="chapter" data-level="1" data-path="chapter1.html"><a href="chapter1.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="chapter1.html"><a href="chapter1.html#understanding-data"><i class="fa fa-check"></i><b>1.1</b> Understanding Data</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="chapter1.html"><a href="chapter1.html#example-1-supervised-learning-continuous-output"><i class="fa fa-check"></i><b>1.1.1</b> Example 1 (Supervised learning: Continuous output)</a></li>
<li class="chapter" data-level="1.1.2" data-path="chapter1.html"><a href="chapter1.html#example-2-supervised-leraning-categorical-output"><i class="fa fa-check"></i><b>1.1.2</b> Example 2 (Supervised leraning: Categorical output)</a></li>
<li class="chapter" data-level="1.1.3" data-path="chapter1.html"><a href="chapter1.html#example-3-unsupervised-learning-clustering-observations"><i class="fa fa-check"></i><b>1.1.3</b> Example 3 (Unsupervised learning: Clustering observations)</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="chapter1.html"><a href="chapter1.html#brief-history-of-statistical-learning"><i class="fa fa-check"></i><b>1.2</b> Brief History of Statistical Learning</a></li>
<li class="chapter" data-level="1.3" data-path="chapter1.html"><a href="chapter1.html#notation-and-simple-matrix-algebra"><i class="fa fa-check"></i><b>1.3</b> Notation and Simple Matrix Algebra</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter2.html"><a href="chapter2.html"><i class="fa fa-check"></i><b>2</b> Statistical Learning</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter2.html"><a href="chapter2.html#what-is-statitical-learning"><i class="fa fa-check"></i><b>2.1</b> What is Statitical Learning</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="chapter2.html"><a href="chapter2.html#prediction"><i class="fa fa-check"></i><b>2.1.1</b> Prediction</a></li>
<li class="chapter" data-level="2.1.2" data-path="chapter2.html"><a href="chapter2.html#inference"><i class="fa fa-check"></i><b>2.1.2</b> Inference</a></li>
<li class="chapter" data-level="2.1.3" data-path="chapter2.html"><a href="chapter2.html#estimating-f"><i class="fa fa-check"></i><b>2.1.3</b> Estimating <span class="math inline">\(f\)</span></a></li>
<li class="chapter" data-level="2.1.4" data-path="chapter2.html"><a href="chapter2.html#prediction-accuaracy-and-model-interpretability"><i class="fa fa-check"></i><b>2.1.4</b> Prediction Accuaracy and Model Interpretability</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="chapter2.html"><a href="chapter2.html#assessing-model-accuracy"><i class="fa fa-check"></i><b>2.2</b> Assessing Model Accuracy</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="chapter2.html"><a href="chapter2.html#measuring-the-quality-of-fit"><i class="fa fa-check"></i><b>2.2.1</b> Measuring the Quality of Fit</a></li>
<li class="chapter" data-level="2.2.2" data-path="chapter2.html"><a href="chapter2.html#bias-variance-trade-off"><i class="fa fa-check"></i><b>2.2.2</b> Bias-Variance Trade-off</a></li>
<li class="chapter" data-level="2.2.3" data-path="chapter2.html"><a href="chapter2.html#classification-problems"><i class="fa fa-check"></i><b>2.2.3</b> Classification Problems</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter3.html"><a href="chapter3.html"><i class="fa fa-check"></i><b>3</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter3.html"><a href="chapter3.html#basic-commands"><i class="fa fa-check"></i><b>3.1</b> Basic Commands</a></li>
<li class="chapter" data-level="3.2" data-path="chapter3.html"><a href="chapter3.html#graphics"><i class="fa fa-check"></i><b>3.2</b> Graphics</a></li>
<li class="chapter" data-level="3.3" data-path="chapter3.html"><a href="chapter3.html#indexing-data"><i class="fa fa-check"></i><b>3.3</b> Indexing Data</a></li>
<li class="chapter" data-level="3.4" data-path="chapter3.html"><a href="chapter3.html#loading-data"><i class="fa fa-check"></i><b>3.4</b> Loading Data</a></li>
<li class="chapter" data-level="3.5" data-path="chapter3.html"><a href="chapter3.html#additional-graphical-and-numerical-summaries"><i class="fa fa-check"></i><b>3.5</b> Additional Graphical and Numerical Summaries</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter4.html"><a href="chapter4.html"><i class="fa fa-check"></i><b>4</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chapter4.html"><a href="chapter4.html#simple-regression"><i class="fa fa-check"></i><b>4.1</b> Simple Regression</a></li>
<li class="chapter" data-level="4.2" data-path="chapter4.html"><a href="chapter4.html#multiple-regression"><i class="fa fa-check"></i><b>4.2</b> Multiple Regression</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="chapter4.html"><a href="chapter4.html#importance-of-predictors-statistical-significance-of-coefficients"><i class="fa fa-check"></i><b>4.2.1</b> Importance of Predictors: Statistical Significance of Coefficients</a></li>
<li class="chapter" data-level="4.2.2" data-path="chapter4.html"><a href="chapter4.html#selecting-important-variables"><i class="fa fa-check"></i><b>4.2.2</b> Selecting Important Variables</a></li>
<li class="chapter" data-level="4.2.3" data-path="chapter4.html"><a href="chapter4.html#model-fit"><i class="fa fa-check"></i><b>4.2.3</b> Model Fit</a></li>
<li class="chapter" data-level="4.2.4" data-path="chapter4.html"><a href="chapter4.html#prediction-1"><i class="fa fa-check"></i><b>4.2.4</b> Prediction</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="chapter4.html"><a href="chapter4.html#other-consideration"><i class="fa fa-check"></i><b>4.3</b> Other Consideration</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="chapter4.html"><a href="chapter4.html#qualitative-predictors"><i class="fa fa-check"></i><b>4.3.1</b> Qualitative Predictors</a></li>
<li class="chapter" data-level="" data-path="chapter4.html"><a href="chapter4.html#example-8"><i class="fa fa-check"></i>Example 8</a></li>
<li class="chapter" data-level="4.3.2" data-path="chapter4.html"><a href="chapter4.html#potential-problems"><i class="fa fa-check"></i><b>4.3.2</b> Potential Problems</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="chapter4.html"><a href="chapter4.html#non-parametric-regressions"><i class="fa fa-check"></i><b>4.4</b> Non-parametric Regressions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter5.html"><a href="chapter5.html"><i class="fa fa-check"></i><b>5</b> Classification</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter5.html"><a href="chapter5.html#logit-and-probit-models"><i class="fa fa-check"></i><b>5.1</b> Logit and Probit Models</a></li>
<li class="chapter" data-level="5.2" data-path="chapter5.html"><a href="chapter5.html#confounding"><i class="fa fa-check"></i><b>5.2</b> Confounding</a></li>
<li class="chapter" data-level="5.3" data-path="chapter5.html"><a href="chapter5.html#logit-model-for-multiple-classes"><i class="fa fa-check"></i><b>5.3</b> Logit Model for Multiple Classes</a></li>
<li class="chapter" data-level="5.4" data-path="chapter5.html"><a href="chapter5.html#discriminant-analysis"><i class="fa fa-check"></i><b>5.4</b> Discriminant Analysis</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="chapter5.html"><a href="chapter5.html#bayes-theorem-for-classification"><i class="fa fa-check"></i><b>5.4.1</b> Bayes Theorem for Classification</a></li>
<li class="chapter" data-level="5.4.2" data-path="chapter5.html"><a href="chapter5.html#linear-discriminant-analysis"><i class="fa fa-check"></i><b>5.4.2</b> Linear Discriminant Analysis</a></li>
<li class="chapter" data-level="5.4.3" data-path="chapter5.html"><a href="chapter5.html#quadratic-discriminant-analysis"><i class="fa fa-check"></i><b>5.4.3</b> Quadratic Discriminant Analysis</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="chapter5.html"><a href="chapter5.html#naive-bayes"><i class="fa fa-check"></i><b>5.5</b> Naive Bayes</a></li>
<li class="chapter" data-level="5.6" data-path="chapter5.html"><a href="chapter5.html#knn-classification"><i class="fa fa-check"></i><b>5.6</b> KNN Classification</a></li>
<li class="chapter" data-level="5.7" data-path="chapter5.html"><a href="chapter5.html#example-10"><i class="fa fa-check"></i><b>5.7</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter6.html"><a href="chapter6.html"><i class="fa fa-check"></i><b>6</b> Resampling Methods</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter6.html"><a href="chapter6.html#validation-set-approach"><i class="fa fa-check"></i><b>6.1</b> Validation Set Approach</a></li>
<li class="chapter" data-level="6.2" data-path="chapter6.html"><a href="chapter6.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>6.2</b> K-fold Cross-validation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="chapter6.html"><a href="chapter6.html#example-11"><i class="fa fa-check"></i><b>6.2.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="chapter6.html"><a href="chapter6.html#bootstrap"><i class="fa fa-check"></i><b>6.3</b> Bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter7.html"><a href="chapter7.html"><i class="fa fa-check"></i><b>7</b> Model Selection</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chapter7.html"><a href="chapter7.html#variable-selection"><i class="fa fa-check"></i><b>7.1</b> Variable Selection</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="chapter7.html"><a href="chapter7.html#best-subset-selection"><i class="fa fa-check"></i><b>7.1.1</b> Best Subset Selection</a></li>
<li class="chapter" data-level="7.1.2" data-path="chapter7.html"><a href="chapter7.html#forward-step-wise-selection"><i class="fa fa-check"></i><b>7.1.2</b> Forward Step Wise Selection</a></li>
<li class="chapter" data-level="7.1.3" data-path="chapter7.html"><a href="chapter7.html#backward-step-wise-selection"><i class="fa fa-check"></i><b>7.1.3</b> Backward Step Wise Selection</a></li>
<li class="chapter" data-level="7.1.4" data-path="chapter7.html"><a href="chapter7.html#choosing-the-optimal-model"><i class="fa fa-check"></i><b>7.1.4</b> Choosing the Optimal Model</a></li>
<li class="chapter" data-level="7.1.5" data-path="chapter7.html"><a href="chapter7.html#example-13"><i class="fa fa-check"></i><b>7.1.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="chapter7.html"><a href="chapter7.html#shrinkage-methods"><i class="fa fa-check"></i><b>7.2</b> Shrinkage Methods</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="chapter7.html"><a href="chapter7.html#ridge-regression"><i class="fa fa-check"></i><b>7.2.1</b> Ridge Regression</a></li>
<li class="chapter" data-level="7.2.2" data-path="chapter7.html"><a href="chapter7.html#rasso-regression"><i class="fa fa-check"></i><b>7.2.2</b> RASSO Regression</a></li>
<li class="chapter" data-level="7.2.3" data-path="chapter7.html"><a href="chapter7.html#example-14"><i class="fa fa-check"></i><b>7.2.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chapter7.html"><a href="chapter7.html#dimension-reduction-methods"><i class="fa fa-check"></i><b>7.3</b> Dimension Reduction Methods</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="chapter7.html"><a href="chapter7.html#principal-components-regression"><i class="fa fa-check"></i><b>7.3.1</b> Principal Components Regression</a></li>
<li class="chapter" data-level="7.3.2" data-path="chapter7.html"><a href="chapter7.html#example-15"><i class="fa fa-check"></i><b>7.3.2</b> Example</a></li>
<li class="chapter" data-level="7.3.3" data-path="chapter7.html"><a href="chapter7.html#partial-least-squares"><i class="fa fa-check"></i><b>7.3.3</b> Partial Least Squares</a></li>
<li class="chapter" data-level="7.3.4" data-path="chapter7.html"><a href="chapter7.html#example-16"><i class="fa fa-check"></i><b>7.3.4</b> Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter8.html"><a href="chapter8.html"><i class="fa fa-check"></i><b>8</b> Moving Beyond Linearity</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chapter8.html"><a href="chapter8.html#polynomial-regression"><i class="fa fa-check"></i><b>8.1</b> Polynomial Regression</a></li>
<li class="chapter" data-level="8.2" data-path="chapter8.html"><a href="chapter8.html#step-functions"><i class="fa fa-check"></i><b>8.2</b> Step Functions</a></li>
<li class="chapter" data-level="8.3" data-path="chapter8.html"><a href="chapter8.html#piecewise-polynomials---splines"><i class="fa fa-check"></i><b>8.3</b> Piecewise Polynomials - Splines</a></li>
<li class="chapter" data-level="8.4" data-path="chapter8.html"><a href="chapter8.html#local-regression"><i class="fa fa-check"></i><b>8.4</b> Local Regression</a></li>
<li class="chapter" data-level="8.5" data-path="chapter8.html"><a href="chapter8.html#generalized-additive-models"><i class="fa fa-check"></i><b>8.5</b> Generalized Additive Models</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter9.html"><a href="chapter9.html"><i class="fa fa-check"></i><b>9</b> Tree-based Methods</a>
<ul>
<li class="chapter" data-level="9.1" data-path="chapter9.html"><a href="chapter9.html#the-basiscs-of-decision-trees"><i class="fa fa-check"></i><b>9.1</b> The Basiscs of Decision Trees</a></li>
<li class="chapter" data-level="9.2" data-path="chapter9.html"><a href="chapter9.html#classification-trees"><i class="fa fa-check"></i><b>9.2</b> Classification Trees</a></li>
<li class="chapter" data-level="9.3" data-path="chapter9.html"><a href="chapter9.html#bagging"><i class="fa fa-check"></i><b>9.3</b> Bagging</a></li>
<li class="chapter" data-level="9.4" data-path="chapter9.html"><a href="chapter9.html#random-forests"><i class="fa fa-check"></i><b>9.4</b> Random Forests</a></li>
<li class="chapter" data-level="9.5" data-path="chapter9.html"><a href="chapter9.html#boosing"><i class="fa fa-check"></i><b>9.5</b> Boosing</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter10.html"><a href="chapter10.html"><i class="fa fa-check"></i><b>10</b> Support Vector Machines</a></li>
<li class="chapter" data-level="11" data-path="chapter11.html"><a href="chapter11.html"><i class="fa fa-check"></i><b>11</b> Unsupervised Learning</a>
<ul>
<li class="chapter" data-level="11.1" data-path="chapter11.html"><a href="chapter11.html#principal-components-anlsysis"><i class="fa fa-check"></i><b>11.1</b> Principal Components Anlsysis</a></li>
<li class="chapter" data-level="11.2" data-path="chapter11.html"><a href="chapter11.html#clustering"><i class="fa fa-check"></i><b>11.2</b> Clustering</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="chapter11.html"><a href="chapter11.html#k-means-clustering"><i class="fa fa-check"></i><b>11.2.1</b> <span class="math inline">\(K\)</span>-means clustering</a></li>
<li class="chapter" data-level="11.2.2" data-path="chapter11.html"><a href="chapter11.html#hierarchical-clustering"><i class="fa fa-check"></i><b>11.2.2</b> Hierarchical Clustering</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter8" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Moving Beyond Linearity<a href="chapter8.html#chapter8" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="the-truth-is-never-linear-or-almost-never" class="section level4 unnumbered hasAnchor">
<h4>The truth is never linear! or almost never!<a href="chapter8.html#the-truth-is-never-linear-or-almost-never" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>But often the linearity assumption is good enough.</p></li>
<li><p>When its not…</p>
<ul>
<li>Polynomials</li>
<li>step functions</li>
<li>splines</li>
<li>local regression</li>
<li>generalized additive models</li>
</ul></li>
</ul>
<p>      offer a lot of flexibility, without losing the case and interpretability of linear models.</p>
<ul>
<li>Linear models may be too rough approximations of the underlying relationships.</li>
<li>However, because the true (non-linear) model is unknown, several approaches have been developed to approximate the underlying true relationship.
<ul>
<li>Polynomials
<ul>
<li>Add powers of predictors to the model.</li>
</ul></li>
<li>Step functions
<ul>
<li>Cut the range of <span class="math inline">\(x\)</span>-valriable(s) to regions and utilize dummy variables to produce piece-wise constant regressions.</li>
</ul></li>
<li>Regression splines
<ul>
<li>Fit essentially different polynomials withing regions of <span class="math inline">\(x\)</span>-variables(s).</li>
</ul></li>
<li>Smoothing splines
<ul>
<li>Extend regression splines with further smoothing.</li>
</ul></li>
<li>Local regression
<ul>
<li>Smooth the (polynomial etc.) fits by allowing overapping regions.</li>
</ul></li>
<li>Generalized additive models
<ul>
<li>Apply different functions (i.e., transformations) to each explanatory variables.</li>
</ul></li>
</ul></li>
</ul>
</div>
<div id="polynomial-regression" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Polynomial Regression<a href="chapter8.html#polynomial-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Polynomial regression fits instead of the simple regression</li>
</ul>
<p><span class="math display">\[
y_i=\beta_0+\beta_1x+\epsilon
\]</span></p>
<ul>
<li>Polynomial function</li>
</ul>
<p><span class="math display">\[
y_i =\beta_0 +\beta_1x_i +\beta_2 x_i^2 + \beta_3 x_i^3 +\cdots +\beta_d x_i^d +\epsilon_i
\]</span></p>
<ul>
<li><p>The motivation is to increase flexibility of the fitted model to capture possible non-linearities.</p></li>
<li><p>Usually the degree of the polynomial is at most three or four.</p></li>
<li><p>Polynomial regression can be applied in logit and probit models as well.</p></li>
</ul>
<p><img src="fig8/f1.png" /></p>
<ul>
<li><p>Create new variabels <span class="math inline">\(X_1=X, X_2=X^2\)</span>, etc and then treat as multiple linear regresison.</p></li>
<li><p>Not really interested in the coefficients; more interested in the fitted function values at any value <span class="math inline">\(x_0\)</span>:</p></li>
</ul>
<p><span class="math display">\[
\hat{f}(x_0) = \hat{\beta}_0 +\hat{\beta_1}x_0 +\hat{\beta}_2 x_0^2 +\hat{\beta}_3 x_0^3 +\hat{\beta}_4 x_0^4
\]</span></p>
<ul>
<li><p>Since <span class="math inline">\(\hat{f}(x_0)\)</span> is a linear function of the <span class="math inline">\(\hat{\beta}_l\)</span>, can get a simple exression for pointwise-variances <span class="math inline">\(Var[\hat{f}(x_0)]\)</span> at any value <span class="math inline">\(x_0\)</span>.</p>
<ul>
<li>In the figure we have computed the fit and pointwise standard errors aon a grid of values for <span class="math inline">\(x_0\)</span>.</li>
<li>We show <span class="math inline">\(\hat{f}(x_0)\pm 2\cdot se[\hat{f}(x_0)]\)</span>.</li>
</ul></li>
<li><p>We either fix the degree <span class="math inline">\(d\)</span> at some reasonably low value, else use cross-validation to choose <span class="math inline">\(d\)</span>.</p></li>
<li><p>Logistic regression follows naturally. For esample, in figure we model</p></li>
</ul>
<p><span class="math display">\[
Pr(y_i &gt; 250 | x_i)= \frac{exp(\beta_0 +\beta_1x_i +\beta_2 x_i^2 + \beta_3 x_i^3 +\cdots +\beta_d x_i^d)}{1+exp(\beta_0 +\beta_1x_i +\beta_2 x_i^2 + \beta_3 x_i^3 +\cdots +\beta_d x_i^d)}
\]</span></p>
<ul>
<li><p>To get confidence intervals, compute upper and lower bounds on <em>on the logit scale</em>, and then invert to get on probability scale.</p></li>
<li><p>Can do separately on several variables - just stack the variables into one matrix, and separate out the pieces afterwards.</p></li>
<li><p>Caveat: polynomials have notorious tail behavior - very bad for extrapolation.</p></li>
<li><p>Can fit using <span class="math inline">\(y\sim poly(x, degree=3)\)</span> in formula.</p></li>
<li><p>Example</p>
<ul>
<li>Fit a fourth order polynomial regression in the Wage data by regressing wage on the fourth order polynomial of age.</li>
<li>All coefficient are statistically significant at the 5% level (the fourth order is on the border line).</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="chapter8.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb1-2"><a href="chapter8.html#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="chapter8.html#cb1-3" aria-hidden="true" tabindex="-1"></a>(fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">4</span>), <span class="at">data =</span> Wage)) <span class="co"># polynomial model of order 4</span></span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wage ~ poly(age, 4), data = Wage)
## 
## Coefficients:
##   (Intercept)  poly(age, 4)1  poly(age, 4)2  poly(age, 4)3  poly(age, 4)4  
##        111.70         447.07        -478.32         125.52         -77.91</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="chapter8.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wage ~ poly(age, 4), data = Wage)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -98.707 -24.626  -4.993  15.217 203.693 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    111.7036     0.7287 153.283  &lt; 2e-16 ***
## poly(age, 4)1  447.0679    39.9148  11.201  &lt; 2e-16 ***
## poly(age, 4)2 -478.3158    39.9148 -11.983  &lt; 2e-16 ***
## poly(age, 4)3  125.5217    39.9148   3.145  0.00168 ** 
## poly(age, 4)4  -77.9112    39.9148  -1.952  0.05104 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 39.91 on 2995 degrees of freedom
## Multiple R-squared:  0.08626,    Adjusted R-squared:  0.08504 
## F-statistic: 70.69 on 4 and 2995 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="chapter8.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Wage, <span class="fu">plot</span>(<span class="at">x =</span> age, <span class="at">y =</span> wage, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">col =</span> <span class="st">&quot;light grey&quot;</span>, <span class="at">fg =</span> <span class="st">&quot;gray&quot;</span>)) <span class="co"># scatter plot</span></span>
<span id="cb5-2"><a href="chapter8.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="do">## fitted regression</span></span>
<span id="cb5-3"><a href="chapter8.html#cb5-3" aria-hidden="true" tabindex="-1"></a>(age.range <span class="ot">&lt;-</span> <span class="fu">range</span>(Wage<span class="sc">$</span>age)) <span class="co"># age range to be used to impose the fitted line</span></span></code></pre></div>
<pre><code>## [1] 18 80</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="chapter8.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## predictions, setting se.fit = true procuces also standard errors of the fitted line</span></span>
<span id="cb7-2"><a href="chapter8.html#cb7-2" aria-hidden="true" tabindex="-1"></a>wage.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age =</span> age.range[<span class="dv">1</span>]<span class="sc">:</span>age.range[<span class="dv">2</span>]), <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-3"><a href="chapter8.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wage.pred)</span></code></pre></div>
<pre><code>## List of 4
##  $ fit           : Named num [1:63] 51.9 58.5 64.6 70.2 75.4 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:63] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ se.fit        : Named num [1:63] 5.3 4.37 3.59 2.96 2.46 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:63] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ df            : int 2995
##  $ residual.scale: num 39.9</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="chapter8.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.range[<span class="dv">1</span>]<span class="sc">:</span>age.range[<span class="dv">2</span>], <span class="at">y =</span> wage.pred<span class="sc">$</span>fit, <span class="at">col  =</span> <span class="st">&quot;steel blue&quot;</span>) <span class="co"># fitted line</span></span>
<span id="cb9-2"><a href="chapter8.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 95% lower bound of the fitted line</span></span>
<span id="cb9-3"><a href="chapter8.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.range[<span class="dv">1</span>]<span class="sc">:</span>age.range[<span class="dv">2</span>], <span class="at">y =</span> wage.pred<span class="sc">$</span>fit <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> wage.pred<span class="sc">$</span>se.fit, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="co"># </span></span>
<span id="cb9-4"><a href="chapter8.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 95% upper bound</span></span>
<span id="cb9-5"><a href="chapter8.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.range[<span class="dv">1</span>]<span class="sc">:</span>age.range[<span class="dv">2</span>], <span class="at">y =</span> wage.pred<span class="sc">$</span>fit <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> wage.pred<span class="sc">$</span>se.fit, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="co"># </span></span></code></pre></div>
<p><img src="ILR_files/figure-html/ch8_1-1.png" width="672" /></p>
</div>
<div id="step-functions" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Step Functions<a href="chapter8.html#step-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Polynomial functions impose global structure on <span class="math inline">\(X\)</span>.</p></li>
<li><p>Step functions impose local structures by converting a continuous variable into an ordered categorical variable</p></li>
</ul>
<p><span class="math display">\[
\begin{align}
C_0(x) &amp;= I(x&lt;c_1) \\
C_1(x) &amp;= I(c_1 \le x&lt;c_2) \\
C_2(x) &amp;= I(c_2 \le x&lt;c_3) \\
&amp; \vdots\\
C_{K-1}(x) &amp;= I(c_{K-1} \le x&lt;c_K) \\
C_K(x) &amp;=I(c_K \le x)
\end{align}
\]</span></p>
<p>      where <span class="math inline">\(I(\cdot)\)</span> is and indicator function that returns 1 if the condition is true, and zero otherwise.</p>
<ul>
<li>Because <span class="math inline">\(C_0(x)+C_1(x)+\cdots +C_K(x)=1\)</span>, <span class="math inline">\(C_0(x)\)</span> becomes the reference class, and the dependent variable <span class="math inline">\(y\)</span> is regressed on <span class="math inline">\(C_j(x)\)</span>, <span class="math inline">\(j=1,\ldots, K\)</span>, resulting to (a dummy variable regression)</li>
</ul>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1C_1(x_{i})+\beta_2C_2(x_{i})+\cdots +\beta_KC_K(x_i) +\epsilon_i
\]</span></p>
<ul>
<li><p>As class <span class="math inline">\(C_0(x)\)</span> is the reference class, <span class="math inline">\(\beta_j\)</span>’s indicate deviations from it.</p></li>
<li><p>Some example</p></li>
</ul>
<p><span class="math display">\[
C_1(X)=I(X&lt;35), \,\,\, C_2(X)=I(35\le X &lt;50), \ldots , C_4(X)=I(X\ge 65)
\]</span></p>
<p><img src="fig8/f2.png" /></p>
<ul>
<li><p>Easy to work with. Creates a series of dummy variables representing each group.</p></li>
<li><p>Useful way of creating interactions that are easy to interpret.</p></li>
<li><p>For example, interaction effect of Year and Age:</p></li>
</ul>
<p><span class="math display">\[
I(Year&lt;2005)\cdot Age, \,\,\, I(Year\ge 2005) \cdot Age
\]</span></p>
<p>      would allow for different linear functions in each age category.</p>
<ul>
<li><p>In R: <span class="math inline">\(I(Year&lt;2005)\)</span> or <span class="math inline">\(cut(age, c(18,25,40,65,90))\)</span>.</p></li>
<li><p>Choice of cutpoints or <em>knots</em> can be problematic.</p>
<ul>
<li>For creating nonlinearities, smoother alternatives such as <em>splines</em> are available.</li>
</ul></li>
<li><p>Example</p>
<ul>
<li>Divide age in four sub-intervals and fit regression on the dummy variables based on them</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="chapter8.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb10-2"><a href="chapter8.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Step functions can be defined utilizing R cut() function</span></span>
<span id="cb10-3"><a href="chapter8.html#cb10-3" aria-hidden="true" tabindex="-1"></a>age4cl <span class="ot">&lt;-</span> <span class="fu">cut</span>(Wage<span class="sc">$</span>age, <span class="at">breaks =</span> <span class="dv">4</span>) <span class="co"># four age classes</span></span>
<span id="cb10-4"><a href="chapter8.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">x =</span> <span class="fu">cut</span>(Wage<span class="sc">$</span>age, <span class="at">breaks =</span> <span class="dv">4</span>)) <span class="co"># n of observations in four age classes</span></span></code></pre></div>
<pre><code>## x
## (17.9,33.5]   (33.5,49]   (49,64.5] (64.5,80.1] 
##         750        1399         779          72</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="chapter8.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.step <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> age4cl, <span class="at">data =</span> Wage)) <span class="co"># fit and summarize</span></span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wage ~ age4cl, data = Wage)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -98.126 -24.803  -6.177  16.493 200.519 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         94.158      1.476  63.790   &lt;2e-16 ***
## age4cl(33.5,49]     24.053      1.829  13.148   &lt;2e-16 ***
## age4cl(49,64.5]     23.665      2.068  11.443   &lt;2e-16 ***
## age4cl(64.5,80.1]    7.641      4.987   1.532    0.126    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 40.42 on 2996 degrees of freedom
## Multiple R-squared:  0.0625, Adjusted R-squared:  0.06156 
## F-statistic: 66.58 on 3 and 2996 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="chapter8.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(age.range <span class="ot">&lt;-</span> <span class="fu">min</span>(Wage<span class="sc">$</span>age)<span class="sc">:</span><span class="fu">max</span>(Wage<span class="sc">$</span>age)) <span class="co"># age range from min to max</span></span></code></pre></div>
<pre><code>## [1] 18 80</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="chapter8.html#cb16-1" aria-hidden="true" tabindex="-1"></a>pred.step <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.step, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age4cl =</span> <span class="fu">cut</span>(age.range, <span class="at">breaks =</span> <span class="dv">4</span>)),</span>
<span id="cb16-2"><a href="chapter8.html#cb16-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>) <span class="co"># prediction with 95% confidence interval</span></span>
<span id="cb16-3"><a href="chapter8.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="chapter8.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Wage, <span class="fu">plot</span>(<span class="at">x =</span> age, <span class="at">y =</span> wage, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">col =</span> <span class="st">&quot;light grey&quot;</span>, <span class="at">fg =</span> <span class="st">&quot;gray&quot;</span>))</span>
<span id="cb16-5"><a href="chapter8.html#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="chapter8.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> <span class="fu">min</span>(Wage<span class="sc">$</span>age)<span class="sc">:</span><span class="fu">max</span>(Wage<span class="sc">$</span>age), <span class="at">y =</span> pred.step[,<span class="dv">1</span>], <span class="at">col  =</span> <span class="st">&quot;steel blue&quot;</span>) <span class="co"># fitted line</span></span>
<span id="cb16-7"><a href="chapter8.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 95% lower bound of the fitted line</span></span>
<span id="cb16-8"><a href="chapter8.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> <span class="fu">min</span>(Wage<span class="sc">$</span>age)<span class="sc">:</span><span class="fu">max</span>(Wage<span class="sc">$</span>age), <span class="at">y =</span> pred.step[,<span class="dv">2</span>], <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="co"># </span></span>
<span id="cb16-9"><a href="chapter8.html#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 95% upper bound</span></span>
<span id="cb16-10"><a href="chapter8.html#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> <span class="fu">min</span>(Wage<span class="sc">$</span>age)<span class="sc">:</span><span class="fu">max</span>(Wage<span class="sc">$</span>age), <span class="at">y =</span> pred.step[,<span class="dv">3</span>], <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="co"># </span></span></code></pre></div>
<p><img src="ILR_files/figure-html/ch8_2-1.png" width="672" /></p>
</div>
<div id="piecewise-polynomials---splines" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Piecewise Polynomials - Splines<a href="chapter8.html#piecewise-polynomials---splines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Polynomial regressions and piece-wise constant regression are special cases of a basis function approach</li>
</ul>
<p><span class="math display">\[
y_i=\beta_0 +\beta_1 b_1(x_i) +\beta_2 b_2(x_i) +\cdots +\beta_{K}b_{K}(x_i) +\epsilon_i
\]</span></p>
<p>      where <span class="math inline">\(b_j(x_i)\)</span> are fixed known functions, called <em>basis functions</em>.</p>
<ul>
<li><p>For polynomial regression <span class="math inline">\(b_j(x_i)=x_i^j\)</span> and for piecewise constant functions <span class="math inline">\(b_j(x_i)-I(c_j\le x_i &lt; c_{j+1})\)</span></p></li>
<li><p>Other popular bassis functions are based on Fourier series, wavelets, and on different spline functions.</p></li>
<li><p>Instead of a single polynomial in <span class="math inline">\(X\)</span> over its whole domain, we can rather use different polynomials in regions defined by knots.</p></li>
<li><p>E.g. (see below figure)</p></li>
</ul>
<p><span class="math display">\[
y_i= \begin{cases}  
\beta_{01}+\beta_{11}x_i +\beta_{21}x_i^2 +\beta_{31}x_i^3 +\epsilon, \,\,\, if \,\,\, x_i&lt;c \\
\beta_{02}+\beta_{12}x_i +\beta_{22}x_i^2 +\beta_{32}x_i^3 +\epsilon, \,\,\, if \,\,\, x_i\ge c\\
\end{cases}
\]</span></p>
<ul>
<li><p>Better to add constraints to the polynomials, e.g. continuity.</p></li>
<li><p><strong>Splines</strong> have the “maximum” amount of continuity.</p></li>
</ul>
<p><img src="fig8/f3.png" /></p>
<div id="linear-splines" class="section level4 unnumbered hasAnchor">
<h4>Linear splines<a href="chapter8.html#linear-splines" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>A linear spline with knots at <span class="math inline">\(\xi_k\)</span>, <span class="math inline">\(k=1,\ldots, K\)</span> is a piecewise linear polynomial continuous at each knot.</p></li>
<li><p>We can represent this model as</p></li>
</ul>
<p><span class="math display">\[
y_i=\beta_0 +\beta_1 b_1(x_i) +\beta_2 b_2(x_i) +\cdots +\beta_{K+1}b_{K+1}(x_i) +\epsilon_i
\]</span></p>
<p>      where the <span class="math inline">\(b_k\)</span> are <em>basis functions</em>.</p>
<p><span class="math display">\[
\begin{align}
b_1(x_i) &amp;= x_i \\
b_{k+1}(x_i) &amp;= (x_i-\xi_k)_+, \,\,\, k=1,\ldots, K
\end{align}
\]</span></p>
<ul>
<li>Here the <span class="math inline">\(( )_+\)</span> means <em>positive part</em>; i.e.</li>
</ul>
<p><span class="math display">\[
(x_i-\xi_k)_+ =\begin{cases} x_i-\xi_k, \,\,\, if \,\,\, x_i&gt;\xi_k \\
0, \,\,\, otherwise \end{cases}
\]</span></p>
<p><img src="fig8/f4.png" /></p>
</div>
<div id="cubic-splines" class="section level4 unnumbered hasAnchor">
<h4>Cubic splines<a href="chapter8.html#cubic-splines" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>A cubic spline with knots at <span class="math inline">\(\xi_k\)</span>, <span class="math inline">\(k=1,\ldots, K\)</span> is a piecewise cubic polynomial with continuous derivatives up to order 2 at each knot.</p></li>
<li><p>Again we can represent this model with truncated power basis functions</p></li>
</ul>
<p><span class="math display">\[
y_i=\beta_0 +\beta_1 b_1(x_i) +\beta_2 b_2(x_i) +\cdots +\beta_{K+1}b_{K+1}(x_i) +\epsilon_i
\]</span></p>
<p><span class="math display">\[
\begin{align}
b_1(x_i) &amp;= x_i \\
b_2(x_i) &amp;= x_i^2\\
b_3(x_i) &amp;= x_i^3\\
b_{k+3}(x_i) &amp;= (x_i-\xi_k)_+^3, \,\,\, k=1,\ldots, K
\end{align}
\]</span></p>
<p>      where</p>
<p><span class="math display">\[
(x_i-\xi_k)_+^3 =\begin{cases} (x_i-\xi_k)^3, \,\,\, if \,\,\, x_i&gt;\xi_k \\
0, \,\,\, otherwise \end{cases}
\]</span></p>
<p><img src="fig8/f5.png" /></p>
</div>
<div id="natural-cubic-splines" class="section level4 unnumbered hasAnchor">
<h4>Natural cubic splines<a href="chapter8.html#natural-cubic-splines" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>A natural cubic spline extrapolates linearly beyond the boundary knots.</p></li>
<li><p>This adds <span class="math inline">\(4=2\times 2\)</span> extra constrains, and allows us to put more internal knots for the same degrees of freedom as a regular cubic spline.</p></li>
</ul>
<p><img src="fig8/f6.png" /></p>
<ul>
<li>Fitting splines in R is easy: bs(x, …) for any degree splines, and ns(x, …) for natural cubic splines, in package <em>splines</em>.</li>
</ul>
<p><img src="fig8/f7.png" /></p>
</div>
<div id="knot-placement" class="section level4 unnumbered hasAnchor">
<h4>Knot placement<a href="chapter8.html#knot-placement" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>One strategy is to decide <span class="math inline">\(K\)</span>, the number of Knots, and then place them at appropriate quantiles of the observed <span class="math inline">\(X\)</span>.</p>
<ul>
<li><p>A cubic spline with <span class="math inline">\(K\)</span> knots has <span class="math inline">\(K+4\)</span> parameters or degrees of freedom.</p></li>
<li><p>A natural spline with <span class="math inline">\(K\)</span> knots has <span class="math inline">\(K\)</span> degrees of freedom.</p></li>
</ul>
<p><img src="fig8/f8.png" /></p>
<ul>
<li>Example
<ul>
<li>Splines in R can be fitted utilizing splines package which is part of the base package and is therefore readily available.</li>
<li>Function bs() generates basis functions for splines with the specified set of knots.</li>
<li>Fitting in the Work data set wage on spline function of age with three knots at <span class="math inline">\(\xi_1=25, \xi_2=40\)</span>, and <span class="math inline">\(\xi_3=60\)</span>.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="chapter8.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb17-2"><a href="chapter8.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb17-3"><a href="chapter8.html#cb17-3" aria-hidden="true" tabindex="-1"></a>fit.bs <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>)), <span class="at">data =</span> Wage) <span class="co"># spline regression</span></span>
<span id="cb17-4"><a href="chapter8.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.bs)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wage ~ bs(age, knots = c(25, 40, 60)), data = Wage)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -98.832 -24.537  -5.049  15.209 203.207 
## 
## Coefficients:
##                                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                       60.494      9.460   6.394 1.86e-10 ***
## bs(age, knots = c(25, 40, 60))1    3.980     12.538   0.317 0.750899    
## bs(age, knots = c(25, 40, 60))2   44.631      9.626   4.636 3.70e-06 ***
## bs(age, knots = c(25, 40, 60))3   62.839     10.755   5.843 5.69e-09 ***
## bs(age, knots = c(25, 40, 60))4   55.991     10.706   5.230 1.81e-07 ***
## bs(age, knots = c(25, 40, 60))5   50.688     14.402   3.520 0.000439 ***
## bs(age, knots = c(25, 40, 60))6   16.606     19.126   0.868 0.385338    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 39.92 on 2993 degrees of freedom
## Multiple R-squared:  0.08642,    Adjusted R-squared:  0.08459 
## F-statistic: 47.19 on 6 and 2993 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="chapter8.html#cb19-1" aria-hidden="true" tabindex="-1"></a>age.grid <span class="ot">&lt;-</span> <span class="fu">min</span>(Wage<span class="sc">$</span>age)<span class="sc">:</span><span class="fu">max</span>(Wage<span class="sc">$</span>age) <span class="co"># age grid for plotting the fitted line</span></span>
<span id="cb19-2"><a href="chapter8.html#cb19-2" aria-hidden="true" tabindex="-1"></a>pred.bs <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.bs,</span>
<span id="cb19-3"><a href="chapter8.html#cb19-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age =</span> age.grid),</span>
<span id="cb19-4"><a href="chapter8.html#cb19-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>) <span class="co"># produce confidence interval for the line</span></span>
<span id="cb19-5"><a href="chapter8.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred.bs) <span class="co"># a few first lines of the regression fit and confidence interval</span></span></code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 60.49371 41.94418 79.04325
## 2 62.71254 51.68291 73.74217
## 3 65.81602 58.41249 73.21956
## 4 69.59243 63.05391 76.13096
## 5 73.83004 67.51567 80.14442
## 6 78.31713 72.58930 84.04495</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="chapter8.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## natrural spline fit</span></span>
<span id="cb21-2"><a href="chapter8.html#cb21-2" aria-hidden="true" tabindex="-1"></a>fit.ns <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">ns</span>(age, <span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>)), <span class="at">data =</span> Wage) <span class="co"># natural spline</span></span>
<span id="cb21-3"><a href="chapter8.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.ns)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wage ~ ns(age, knots = c(25, 40, 60)), data = Wage)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -98.733 -24.761  -5.187  15.216 204.965 
## 
## Coefficients:
##                                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                       54.760      5.138  10.658  &lt; 2e-16 ***
## ns(age, knots = c(25, 40, 60))1   67.402      5.013  13.444  &lt; 2e-16 ***
## ns(age, knots = c(25, 40, 60))2   51.383      5.712   8.996  &lt; 2e-16 ***
## ns(age, knots = c(25, 40, 60))3   88.566     12.016   7.371 2.18e-13 ***
## ns(age, knots = c(25, 40, 60))4   10.637      9.833   1.082    0.279    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 39.92 on 2995 degrees of freedom
## Multiple R-squared:  0.08588,    Adjusted R-squared:  0.08466 
## F-statistic: 70.34 on 4 and 2995 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="chapter8.html#cb23-1" aria-hidden="true" tabindex="-1"></a>pred.ns <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.ns, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age =</span> age.grid)) <span class="co"># natural spline fit</span></span>
<span id="cb23-2"><a href="chapter8.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="do">## plot results</span></span>
<span id="cb23-3"><a href="chapter8.html#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Wage, <span class="fu">plot</span>(<span class="at">x =</span> age, <span class="at">y =</span> wage, <span class="at">col =</span> <span class="st">&quot;light gray&quot;</span>,</span>
<span id="cb23-4"><a href="chapter8.html#cb23-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Wage&quot;</span>,</span>
<span id="cb23-5"><a href="chapter8.html#cb23-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">main =</span> <span class="st">&quot;Regression Spline with Three Knots&quot;</span>)) <span class="co"># scatter plot</span></span>
<span id="cb23-6"><a href="chapter8.html#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid, <span class="at">y =</span> pred.bs[, <span class="dv">1</span>], <span class="at">col =</span> <span class="st">&quot;steel blue&quot;</span>) <span class="co"># basis spline fitted line</span></span>
<span id="cb23-7"><a href="chapter8.html#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid, <span class="at">y =</span> pred.bs[, <span class="dv">2</span>], <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="co"># l95 bs regression</span></span>
<span id="cb23-8"><a href="chapter8.html#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid, <span class="at">y =</span> pred.bs[, <span class="dv">3</span>], <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="co"># u95 bs regression</span></span>
<span id="cb23-9"><a href="chapter8.html#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid, <span class="at">y =</span> pred.ns, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co"># natural spline fitted line</span></span>
<span id="cb23-10"><a href="chapter8.html#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>), <span class="at">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb23-11"><a href="chapter8.html#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Basis Spline&quot;</span>, <span class="st">&quot;+/-2 std err (bs)&quot;</span>, <span class="st">&quot;Natural Spline&quot;</span>),</span>
<span id="cb23-12"><a href="chapter8.html#cb23-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">&quot;solid&quot;</span>, <span class="st">&quot;dashed&quot;</span>, <span class="st">&quot;solid&quot;</span>),</span>
<span id="cb23-13"><a href="chapter8.html#cb23-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;steel blue&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="ILR_files/figure-html/ch8_3-1.png" width="672" /></p>
<ul>
<li><p>Instead of defining knots in bs() or ns() we can define the degrees of freedom, df, which defines equal spaced knots.</p></li>
<li><p>Recall, in cubic spline estimates <span class="math inline">\(K+4\)</span> parameters of which one is the intercept.</p></li>
<li><p>Accordingly with <span class="math inline">\(K=3\)</span> knots df is set to 6 in bs().</p></li>
<li><p>In the natural spline the function is required to be linear in the boundary which reduces the number of estimated parameters by 2.</p></li>
<li><p>Therefore for <span class="math inline">\(K=3\)</span> knots df is 4 in ns()</p></li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="chapter8.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  basis spline</span></span>
<span id="cb24-2"><a href="chapter8.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">bs</span>(Wage<span class="sc">$</span>age, <span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>))) <span class="co"># predefined knots</span></span></code></pre></div>
<pre><code>## [1] 3000    6</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="chapter8.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">bs</span>(Wage<span class="sc">$</span>age, <span class="at">df =</span> <span class="dv">6</span>)) <span class="co"># equal spaced knots</span></span></code></pre></div>
<pre><code>## [1] 3000    6</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="chapter8.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">bs</span>(Wage<span class="sc">$</span>age, <span class="at">df =</span> <span class="dv">6</span>), <span class="at">which =</span> <span class="st">&quot;knots&quot;</span>) </span></code></pre></div>
<pre><code>##   25%   50%   75% 
## 33.75 42.00 51.00</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="chapter8.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">bs</span>(Wage<span class="sc">$</span>age, <span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>)), <span class="at">which =</span> <span class="st">&quot;knots&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 25 40 60</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="chapter8.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## natural spline</span></span>
<span id="cb32-2"><a href="chapter8.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">ns</span>(Wage<span class="sc">$</span>age, <span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>))) <span class="co"># predefined knots</span></span></code></pre></div>
<pre><code>## [1] 3000    4</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="chapter8.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">ns</span>(Wage<span class="sc">$</span>age, <span class="at">df =</span> <span class="dv">4</span>)) <span class="co"># equal spaced knots</span></span></code></pre></div>
<pre><code>## [1] 3000    4</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="chapter8.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">ns</span>(Wage<span class="sc">$</span>age, <span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>)), <span class="at">which =</span> <span class="st">&quot;knots&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 25 40 60</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="chapter8.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">ns</span>(Wage<span class="sc">$</span>age, <span class="at">df =</span> <span class="dv">4</span>), <span class="at">which =</span> <span class="st">&quot;knots&quot;</span>)</span></code></pre></div>
<pre><code>##   25%   50%   75% 
## 33.75 42.00 51.00</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="chapter8.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb40-2"><a href="chapter8.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(bs) <span class="do">## arguments of bs() function</span></span></code></pre></div>
<pre><code>## function (x, df = NULL, knots = NULL, degree = 3, intercept = FALSE, 
##     Boundary.knots = range(x)) 
## NULL</code></pre>
<ul>
<li>Finally, by the degree parameter in bs() and ns() functions, the degree of the piecewise polynomial can be defined (default is 3, i.e., cubic)</li>
</ul>
</div>
<div id="smmothing-splines" class="section level4 unnumbered hasAnchor">
<h4>Smmothing splines<a href="chapter8.html#smmothing-splines" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>This section is a little bit mathematical.</p></li>
<li><p>Consider this criterion for fitting a smooth function <span class="math inline">\(g(x)\)</span> to some data:</p></li>
</ul>
<p><span class="math display">\[
minimize_{g\in S} \sum_{i=1}^n (y_i-g(x_i))^2 +\lambda \int g&#39;&#39;(t)^2 dt
\]</span></p>
<ul>
<li><p>The first term is RSS, and tries to make <span class="math inline">\(g(x)\)</span> match the data at each <span class="math inline">\(x_i\)</span>.</p></li>
<li><p>The second term is a <em>roughness penalty</em> and controls how wiggly <span class="math inline">\(g(x)\)</span> is.</p></li>
<li><p>It is modulated by the <em>tuning parameter</em> <span class="math inline">\(\lambda \ge 0\)</span>.</p>
<ul>
<li>The smaller <span class="math inline">\(\lambda\)</span>, the more wiggly the function, eventually interpolating <span class="math inline">\(y_i\)</span> when <span class="math inline">\(\lambda=0\)</span>.</li>
<li>As <span class="math inline">\(\lambda \rightarrow \infty\)</span>, the function <span class="math inline">\(g(x)\)</span> becomes linear.</li>
</ul></li>
<li><p>The solution is a natural cubic spline, with a knot at every unique value of <span class="math inline">\(x_i\)</span>.</p></li>
<li><p>The roughness penalty still controls the roughness via <span class="math inline">\(\lambda\)</span>.</p></li>
<li><p>Some details</p>
<ul>
<li>Smoothing splines avoid the knot-selection issue, leaving a single <span class="math inline">\(\lambda\)</span> to be chosen.</li>
<li>The algorithmic details are too complex to describe here. In R, the function smooth.spline() will fit a smoothing spline.</li>
<li>The vector of <span class="math inline">\(n\)</span> fitted values can be written as <span class="math inline">\(\hat{g}_{\lambda}=S_{\lambda}y\)</span>, where <span class="math inline">\(S_{\lambda}\)</span> is a <span class="math inline">\(n\times n\)</span> matrix (determined by the <span class="math inline">\(x_i\)</span> and <span class="math inline">\(\lambda\)</span>).</li>
<li>The effective degrees of freedom are given by</li>
</ul></li>
</ul>
<p><span class="math display">\[
df_{\lambda}=\sum_{i=1}^n \{S_{\lambda}\}_{ii}
\]</span></p>
<ul>
<li>We can specify <span class="math inline">\(df\)</span> rather then <span class="math inline">\(\lambda\)</span>!
<ul>
<li>In R: smooth.spline(age, wage, df=10)</li>
</ul></li>
<li>The leave-one-out (LOO) cross-validated error is given by</li>
</ul>
<p><span class="math display">\[
RSS_{cv}(\lambda)=\sum_{i=1}^n (y_i-\hat{g}_{\lambda}^{(-1)}(x_i))^2=\sum_{i=1}^n [\frac{y_i-\hat{g}_{\lambda}(x_i)}{1-\{S_{\lambda}\}_{ii}}]^2
\]</span></p>
<ul>
<li>In R: smooth.spline(age, wage)</li>
</ul>
<p><img src="fig8/f9.png" /></p>
<ul>
<li>Example
<ul>
<li>Continuing with the Wage data, fitting smoothing splines can be performed by smooth.spline() function in the splines package.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="chapter8.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb42-2"><a href="chapter8.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb42-3"><a href="chapter8.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">#help(smooth.spline) # see some help</span></span>
<span id="cb42-4"><a href="chapter8.html#cb42-4" aria-hidden="true" tabindex="-1"></a>fit.smooth <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="at">x =</span> Wage<span class="sc">$</span>age, <span class="at">y =</span> Wage<span class="sc">$</span>wage, <span class="at">df =</span> <span class="dv">16</span>) <span class="co"># fixed number of 16 knots</span></span>
<span id="cb42-5"><a href="chapter8.html#cb42-5" aria-hidden="true" tabindex="-1"></a>fit.smooth2 <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="at">x =</span> Wage<span class="sc">$</span>age, <span class="at">y =</span> Wage<span class="sc">$</span>wage, <span class="at">cv =</span> <span class="cn">TRUE</span>) <span class="co"># LOOCV</span></span></code></pre></div>
<pre><code>## Warning in smooth.spline(x = Wage$age, y = Wage$wage, cv = TRUE): cross-
## validation with non-unique &#39;x&#39; values seems doubtful</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="chapter8.html#cb44-1" aria-hidden="true" tabindex="-1"></a>fit.smooth3 <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="at">x =</span> Wage<span class="sc">$</span>age, <span class="at">y =</span> Wage<span class="sc">$</span>wage) <span class="co"># dafaul &#39;generalized CV&#39;</span></span>
<span id="cb44-2"><a href="chapter8.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(fit.smooth2<span class="sc">$</span>df, <span class="at">digits =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 6.8</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="chapter8.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(fit.smooth3<span class="sc">$</span>df, <span class="at">digits =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 6.5</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="chapter8.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Wage, <span class="fu">plot</span>(<span class="at">x =</span> age, <span class="at">y =</span> wage,</span>
<span id="cb48-2"><a href="chapter8.html#cb48-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">cex =</span> .<span class="dv">5</span>, <span class="co"># reduce the size of the plotting symbol to one half</span></span>
<span id="cb48-3"><a href="chapter8.html#cb48-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb48-4"><a href="chapter8.html#cb48-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Wage&quot;</span>,</span>
<span id="cb48-5"><a href="chapter8.html#cb48-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">main =</span> <span class="st">&quot;Smoothing Spline&quot;</span>))</span>
<span id="cb48-6"><a href="chapter8.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.smooth, <span class="at">col =</span> <span class="st">&quot;steel blue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co"># fitted line, lwd = 2 doubles the line thickness</span></span>
<span id="cb48-7"><a href="chapter8.html#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.smooth2, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co"># LOOCV</span></span>
<span id="cb48-8"><a href="chapter8.html#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="do">## lines(fit.smooth3, col = &quot;green&quot;, lwd = 2) # &#39;generalized&#39; CV, not shown as almost identical</span></span>
<span id="cb48-9"><a href="chapter8.html#cb48-9" aria-hidden="true" tabindex="-1"></a>                                              <span class="co"># to LOOCV</span></span>
<span id="cb48-10"><a href="chapter8.html#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="chapter8.html#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">&quot;Fixed&quot;</span>, <span class="fu">round</span>(fit.smooth<span class="sc">$</span>df, <span class="dv">0</span>), <span class="st">&quot;df&quot;</span>),</span>
<span id="cb48-12"><a href="chapter8.html#cb48-12" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">paste</span>(<span class="st">&quot;LOOCV&quot;</span>, <span class="fu">round</span>(fit.smooth2<span class="sc">$</span>df, <span class="dv">1</span>), <span class="st">&quot;df&quot;</span>)),</span>
<span id="cb48-13"><a href="chapter8.html#cb48-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;steel blue&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">lty =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="ILR_files/figure-html/ch8_5-1.png" width="672" /></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="chapter8.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="do">## dev.print(pdf, file = &quot;ex64.pdf&quot;) # pdf copy</span></span>
<span id="cb49-2"><a href="chapter8.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="do">## lambdas</span></span>
<span id="cb49-3"><a href="chapter8.html#cb49-3" aria-hidden="true" tabindex="-1"></a>fit.smooth<span class="sc">$</span>lambda <span class="co"># fixed df</span></span></code></pre></div>
<pre><code>## [1] 0.0006537868</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="chapter8.html#cb51-1" aria-hidden="true" tabindex="-1"></a>fit.smooth2<span class="sc">$</span>lambda <span class="co"># LOOCV</span></span></code></pre></div>
<pre><code>## [1] 0.02792303</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="chapter8.html#cb53-1" aria-hidden="true" tabindex="-1"></a>fit.smooth3<span class="sc">$</span>lambda <span class="co"># &#39;generalized&#39; CV</span></span></code></pre></div>
<pre><code>## [1] 0.0348627</code></pre>
</div>
</div>
<div id="local-regression" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Local Regression<a href="chapter8.html#local-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Loal regression gives another approach for fitting flexible non-linear functions.</p></li>
<li><p>The general idea is to fit weighted least squares in the neighboring points around a given point <span class="math inline">\(x_0\)</span>.</p></li>
<li><p>The (relative) number of points around which the (weighted) least squares is applied is defined by the span parameter <span class="math inline">\(s\)</span>.</p></li>
<li><p>The weighting function <span class="math inline">\(K_{i0}\)</span> is often referred to as the weight function.</p></li>
<li><p>The graph below illustrates the idea of local regressions for a simulated data, the yellow areas refers to the weighting function, the blue line is the underlying true function <span class="math inline">\(f(x)\)</span>, the orange is the fitted local regression estimate <span class="math inline">\(\hat{f}(x)\)</span>, and the red lines refer to the local weighted regressions around the particular <span class="math inline">\(x\)</span> value.</p></li>
</ul>
<p><img src="fig8/f10.png" /></p>
<ul>
<li><p>With a sliding weight function, we fit separate linear fits over the range of <span class="math inline">\(X\)</span> by weighted least squares.</p></li>
<li><p>See test for more details, and loess() function in R.</p></li>
<li><p>Example</p>
<ul>
<li>Local regressions with span values 0.2 and 0.5</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="chapter8.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb55-2"><a href="chapter8.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="do">## use loess (localally estimated scatter plot smoother) function to fit a locall regression</span></span>
<span id="cb55-3"><a href="chapter8.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="do">## R has also lowess (locally weighted scatter plot smoother)</span></span>
<span id="cb55-4"><a href="chapter8.html#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">#help(loess) # help for loess</span></span>
<span id="cb55-5"><a href="chapter8.html#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co">#help(lowess) # help for lowess</span></span>
<span id="cb55-6"><a href="chapter8.html#cb55-6" aria-hidden="true" tabindex="-1"></a>fit.loess02 <span class="ot">&lt;-</span> <span class="fu">loess</span>(wage <span class="sc">~</span> age, <span class="at">data =</span> Wage, <span class="at">span =</span> .<span class="dv">2</span>)</span>
<span id="cb55-7"><a href="chapter8.html#cb55-7" aria-hidden="true" tabindex="-1"></a>fit.loess05 <span class="ot">&lt;-</span> <span class="fu">loess</span>(wage <span class="sc">~</span> age, <span class="at">data =</span> Wage, <span class="at">span =</span> .<span class="dv">5</span>)</span>
<span id="cb55-8"><a href="chapter8.html#cb55-8" aria-hidden="true" tabindex="-1"></a>age.grid <span class="ot">&lt;-</span> <span class="fu">min</span>(Wage<span class="sc">$</span>age)<span class="sc">:</span><span class="fu">max</span>(Wage<span class="sc">$</span>age) <span class="co"># needed for prediction to plot fitted lines</span></span>
<span id="cb55-9"><a href="chapter8.html#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> Wage, <span class="fu">plot</span>(<span class="at">x =</span> age, <span class="at">y =</span> wage, <span class="at">cex =</span> .<span class="dv">5</span>, <span class="at">col =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb55-10"><a href="chapter8.html#cb55-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Wage&quot;</span>,</span>
<span id="cb55-11"><a href="chapter8.html#cb55-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">main =</span> <span class="st">&quot;Local Regression&quot;</span>))</span>
<span id="cb55-12"><a href="chapter8.html#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid, <span class="fu">predict</span>(fit.loess02, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age =</span> age.grid)), <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb55-13"><a href="chapter8.html#cb55-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="co"># loess with s = .2</span></span>
<span id="cb55-14"><a href="chapter8.html#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid, <span class="fu">predict</span>(fit.loess05, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age =</span> age.grid)), <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb55-15"><a href="chapter8.html#cb55-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="co"># s = .5</span></span>
<span id="cb55-16"><a href="chapter8.html#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;span = 0.2&quot;</span>, <span class="st">&quot;span = 0.5&quot;</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb55-17"><a href="chapter8.html#cb55-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="ILR_files/figure-html/ch8_6-1.png" width="672" /></p>
</div>
<div id="generalized-additive-models" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Generalized Additive Models<a href="chapter8.html#generalized-additive-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Generalizes additive models (GAMs) deal with multiple regression with several predictors, <span class="math inline">\(x_1, \ldots, x_p\)</span> by allowing nonlinear functions of each predictor, while maintaining additivity.</p></li>
<li><p>Allows for flexible nonlinearities in several variables, but retains the additive structure of linear models.</p></li>
</ul>
<p><span class="math display">\[
y_i=\beta_0 +f_1 (x_{i1})+f_2 (x_{i2})+\cdots +f_p(x_{ip})+\epsilon
\]</span></p>
<p><img src="fig8/f11.png" /></p>
<ul>
<li><p>Can fit a GAM simply using, e.g. natural splines:</p>
<ul>
<li>lm(wage ~ ns(year, df=5) + ns(age, df=5) + education)</li>
</ul></li>
<li><p>Coefficients not that interesting; fitted functions are. The previous plot was produced using plot.gam.</p></li>
<li><p>Can mix terms - some linear, some nonlinear - and use anova() to compare models.</p></li>
<li><p>Can use smoothing splines or local regression as well:</p>
<ul>
<li>gam(wage ~ s(year, df=5) + lo(age, span=.5) + education)</li>
</ul></li>
<li><p>GAMs are additive, although low-order interactions can be included in a natural way using, e.g. bivariate smoothers or interactions of the form ns(age, df=5):ns(year, df=5)</p></li>
</ul>
<div id="gams-for-classification" class="section level4 unnumbered hasAnchor">
<h4>GAMs for classification<a href="chapter8.html#gams-for-classification" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><span class="math display">\[
log(\frac{p(X)}{1-p(X)})=\beta_0 +f_1(X_1) +f_2(X_2) +\cdots +f_p(X_p)
\]</span></p>
<p><img src="fig8/f12.png" /></p>
<ul>
<li><p>gam(I(wage&gt;250) ~ year + s(age, df=5) + education, family=binomial)</p></li>
<li><p>Example</p>
<ul>
<li>Consider again the Wage data and fit the model</li>
</ul></li>
</ul>
<p><span class="math display">\[
wage =\beta_0 +f_1(year)+f_2(age)+f_3(education)+\epsilon
\]</span>
      utilizing natural splines.</p>
<ul>
<li>year and age are quantitative and education is qualitative with five levels (less than hs, hs, some college, college, advanced).</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="chapter8.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb56-2"><a href="chapter8.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb56-3"><a href="chapter8.html#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="at">help =</span> splines)</span>
<span id="cb56-4"><a href="chapter8.html#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Wage)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    3000 obs. of  11 variables:
##  $ year      : int  2006 2004 2003 2003 2005 2008 2009 2008 2006 2004 ...
##  $ age       : int  18 24 45 43 50 54 44 30 41 52 ...
##  $ maritl    : Factor w/ 5 levels &quot;1. Never Married&quot;,..: 1 1 2 2 4 2 2 1 1 2 ...
##  $ race      : Factor w/ 4 levels &quot;1. White&quot;,&quot;2. Black&quot;,..: 1 1 1 3 1 1 4 3 2 1 ...
##  $ education : Factor w/ 5 levels &quot;1. &lt; HS Grad&quot;,..: 1 4 3 4 2 4 3 3 3 2 ...
##  $ region    : Factor w/ 9 levels &quot;1. New England&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ jobclass  : Factor w/ 2 levels &quot;1. Industrial&quot;,..: 1 2 1 2 2 2 1 2 2 2 ...
##  $ health    : Factor w/ 2 levels &quot;1. &lt;=Good&quot;,&quot;2. &gt;=Very Good&quot;: 1 2 1 2 1 2 2 1 2 2 ...
##  $ health_ins: Factor w/ 2 levels &quot;1. Yes&quot;,&quot;2. No&quot;: 2 2 1 1 1 1 1 1 1 1 ...
##  $ logwage   : num  4.32 4.26 4.88 5.04 4.32 ...
##  $ wage      : num  75 70.5 131 154.7 75 ...</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="chapter8.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(Wage<span class="sc">$</span>education)</span></code></pre></div>
<pre><code>## [1] &quot;1. &lt; HS Grad&quot;       &quot;2. HS Grad&quot;         &quot;3. Some College&quot;   
## [4] &quot;4. College Grad&quot;    &quot;5. Advanced Degree&quot;</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="chapter8.html#cb60-1" aria-hidden="true" tabindex="-1"></a>gam1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">ns</span>(year, <span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">ns</span>(age, <span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education, <span class="at">data =</span> Wage) <span class="co"># natural splines</span></span>
<span id="cb60-2"><a href="chapter8.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gam1) <span class="co"># regression summary</span></span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wage ~ ns(year, df = 4) + ns(age, df = 5) + education, 
##     data = Wage)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -120.513  -19.608   -3.583   14.112  214.535 
## 
## Coefficients:
##                             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                   46.949      4.704   9.980  &lt; 2e-16 ***
## ns(year, df = 4)1              8.625      3.466   2.488  0.01289 *  
## ns(year, df = 4)2              3.762      2.959   1.271  0.20369    
## ns(year, df = 4)3              8.127      4.211   1.930  0.05375 .  
## ns(year, df = 4)4              6.806      2.397   2.840  0.00455 ** 
## ns(age, df = 5)1              45.170      4.193  10.771  &lt; 2e-16 ***
## ns(age, df = 5)2              38.450      5.076   7.575 4.78e-14 ***
## ns(age, df = 5)3              34.239      4.383   7.813 7.69e-15 ***
## ns(age, df = 5)4              48.678     10.572   4.605 4.31e-06 ***
## ns(age, df = 5)5               6.557      8.367   0.784  0.43328    
## education2. HS Grad           10.983      2.430   4.520 6.43e-06 ***
## education3. Some College      23.473      2.562   9.163  &lt; 2e-16 ***
## education4. College Grad      38.314      2.547  15.042  &lt; 2e-16 ***
## education5. Advanced Degree   62.554      2.761  22.654  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 35.16 on 2986 degrees of freedom
## Multiple R-squared:  0.293,  Adjusted R-squared:  0.2899 
## F-statistic:  95.2 on 13 and 2986 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="chapter8.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb62-2"><a href="chapter8.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Marginal effects</span></span>
<span id="cb62-3"><a href="chapter8.html#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb62-4"><a href="chapter8.html#cb62-4" aria-hidden="true" tabindex="-1"></a>year.grid <span class="ot">&lt;-</span> <span class="fu">min</span>(Wage<span class="sc">$</span>year)<span class="sc">:</span><span class="fu">max</span>(Wage<span class="sc">$</span>year)</span>
<span id="cb62-5"><a href="chapter8.html#cb62-5" aria-hidden="true" tabindex="-1"></a>age.grid <span class="ot">&lt;-</span> <span class="fu">min</span>(Wage<span class="sc">$</span>age)<span class="sc">:</span><span class="fu">max</span>(Wage<span class="sc">$</span>age)</span>
<span id="cb62-6"><a href="chapter8.html#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Year effect at the mean of age and education level &quot;College Grad&quot; (level 4)</span></span>
<span id="cb62-7"><a href="chapter8.html#cb62-7" aria-hidden="true" tabindex="-1"></a>pred.wage1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(gam1, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">year =</span> year.grid,</span>
<span id="cb62-8"><a href="chapter8.html#cb62-8" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">age =</span> <span class="fu">mean</span>(Wage<span class="sc">$</span>age),</span>
<span id="cb62-9"><a href="chapter8.html#cb62-9" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">education =</span> <span class="fu">levels</span>(Wage<span class="sc">$</span>education)[<span class="dv">4</span>]),</span>
<span id="cb62-10"><a href="chapter8.html#cb62-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>) <span class="co"># year effect</span></span>
<span id="cb62-11"><a href="chapter8.html#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Age effect at the mean of year (or we could just fix year to some fixed value, e.g., 2005)</span></span>
<span id="cb62-12"><a href="chapter8.html#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="do">## and education level &quot;College Grad&quot;</span></span>
<span id="cb62-13"><a href="chapter8.html#cb62-13" aria-hidden="true" tabindex="-1"></a>pred.wage2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(gam1, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age =</span> age.grid,</span>
<span id="cb62-14"><a href="chapter8.html#cb62-14" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">year =</span> <span class="fu">mean</span>(Wage<span class="sc">$</span>year),</span>
<span id="cb62-15"><a href="chapter8.html#cb62-15" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">education =</span> <span class="fu">levels</span>(Wage<span class="sc">$</span>education)[<span class="dv">4</span>]),</span>
<span id="cb62-16"><a href="chapter8.html#cb62-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>) <span class="co"># age effect</span></span>
<span id="cb62-17"><a href="chapter8.html#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Education effect at the mean age and mean year value</span></span>
<span id="cb62-18"><a href="chapter8.html#cb62-18" aria-hidden="true" tabindex="-1"></a>pred.wage3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(gam1, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age =</span> <span class="fu">mean</span>(Wage<span class="sc">$</span>age),</span>
<span id="cb62-19"><a href="chapter8.html#cb62-19" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">year =</span> <span class="fu">mean</span>(Wage<span class="sc">$</span>year),</span>
<span id="cb62-20"><a href="chapter8.html#cb62-20" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">education =</span> <span class="fu">levels</span>(Wage<span class="sc">$</span>education)),</span>
<span id="cb62-21"><a href="chapter8.html#cb62-21" aria-hidden="true" tabindex="-1"></a>                      <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>)</span>
<span id="cb62-22"><a href="chapter8.html#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)) <span class="co"># split graph window into tree segemnts</span></span>
<span id="cb62-23"><a href="chapter8.html#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Year marginal effect plot</span></span>
<span id="cb62-24"><a href="chapter8.html#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Wage, <span class="fu">plot</span>(<span class="at">x =</span> year, <span class="at">y =</span> wage, <span class="at">cex =</span> .<span class="dv">5</span>, <span class="at">col =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb62-25"><a href="chapter8.html#cb62-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlab =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Log(Wage)&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Marginal Effect of Year&quot;</span>))</span>
<span id="cb62-26"><a href="chapter8.html#cb62-26" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> year.grid, <span class="at">y =</span> pred.wage1[, <span class="dv">1</span>], <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb62-27"><a href="chapter8.html#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> year.grid, <span class="at">y =</span> pred.wage1[, <span class="dv">2</span>], <span class="at">col =</span> <span class="st">&quot;steel blue&quot;</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb62-28"><a href="chapter8.html#cb62-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> year.grid, <span class="at">y =</span> pred.wage1[, <span class="dv">3</span>], <span class="at">col =</span> <span class="st">&quot;steel blue&quot;</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb62-29"><a href="chapter8.html#cb62-29" aria-hidden="true" tabindex="-1"></a><span class="do">## Age marginal effect plot</span></span>
<span id="cb62-30"><a href="chapter8.html#cb62-30" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Wage, <span class="fu">plot</span>(<span class="at">x =</span> age, <span class="at">y =</span> wage, <span class="at">cex =</span> .<span class="dv">5</span>, <span class="at">col =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb62-31"><a href="chapter8.html#cb62-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Wage&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Marginal Effect of Age&quot;</span>))</span>
<span id="cb62-32"><a href="chapter8.html#cb62-32" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid, <span class="at">y =</span> pred.wage2[, <span class="dv">1</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb62-33"><a href="chapter8.html#cb62-33" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid, <span class="at">y =</span> pred.wage2[, <span class="dv">2</span>], <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">col =</span> <span class="st">&quot;steel blue&quot;</span>)</span>
<span id="cb62-34"><a href="chapter8.html#cb62-34" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid, <span class="at">y =</span> pred.wage2[, <span class="dv">3</span>], <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">col =</span> <span class="st">&quot;steel blue&quot;</span>)</span>
<span id="cb62-35"><a href="chapter8.html#cb62-35" aria-hidden="true" tabindex="-1"></a><span class="do">## Education marginal effect plot</span></span>
<span id="cb62-36"><a href="chapter8.html#cb62-36" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Wage, <span class="fu">plot</span>(<span class="at">x =</span> education, <span class="at">y =</span> wage, <span class="at">xlab =</span> <span class="st">&quot;Education&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Wage&quot;</span>,</span>
<span id="cb62-37"><a href="chapter8.html#cb62-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">main =</span> <span class="st">&quot;Marginal Effect of Education&quot;</span>)) <span class="co"># education effect</span></span>
<span id="cb62-38"><a href="chapter8.html#cb62-38" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">y =</span> pred.wage3[, <span class="dv">1</span>], <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb62-39"><a href="chapter8.html#cb62-39" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">y =</span> pred.wage3[, <span class="dv">2</span>], <span class="at">col =</span> <span class="st">&quot;steel blue&quot;</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb62-40"><a href="chapter8.html#cb62-40" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">y =</span> pred.wage3[, <span class="dv">3</span>], <span class="at">col =</span> <span class="st">&quot;steel blue&quot;</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="ILR_files/figure-html/ch8_7-1.png" width="672" /></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="chapter8.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb63-2"><a href="chapter8.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="do">##dev.print(pdf, file = &quot;ex66.pdf&quot;)</span></span>
<span id="cb63-3"><a href="chapter8.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb63-4"><a href="chapter8.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(pkgs = &quot;gam&quot;, repos = &quot;https://cran.uib.no&quot;)</span></span>
<span id="cb63-5"><a href="chapter8.html#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gam)</span>
<span id="cb63-6"><a href="chapter8.html#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co">#library(help = gam) # some info about gam library</span></span>
<span id="cb63-7"><a href="chapter8.html#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="chapter8.html#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="do">## utilize plot.Gam to produce graphs between each normal spline features and respnse</span></span>
<span id="cb63-9"><a href="chapter8.html#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb63-10"><a href="chapter8.html#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.Gam</span>(gam1, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">30</span>), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb63-11"><a href="chapter8.html#cb63-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&quot;f(year)&quot;</span>, <span class="at">terms =</span> <span class="fu">attr</span>(gam1<span class="sc">$</span>terms, <span class="at">which =</span> <span class="st">&quot;term.labels&quot;</span>)[<span class="dv">1</span>])</span>
<span id="cb63-12"><a href="chapter8.html#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.Gam</span>(gam1, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">30</span>), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb63-13"><a href="chapter8.html#cb63-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&quot;f(age)&quot;</span>, <span class="at">terms =</span> <span class="fu">attr</span>(gam1<span class="sc">$</span>terms, <span class="at">which =</span> <span class="st">&quot;term.labels&quot;</span>)[<span class="dv">2</span>])</span>
<span id="cb63-14"><a href="chapter8.html#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.Gam</span>(gam1, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">30</span>), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb63-15"><a href="chapter8.html#cb63-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&quot;f(education)&quot;</span>, <span class="at">terms =</span> <span class="fu">attr</span>(gam1<span class="sc">$</span>terms, <span class="at">which =</span> <span class="st">&quot;term.labels&quot;</span>)[<span class="dv">3</span>])</span></code></pre></div>
<p><img src="ILR_files/figure-html/ch8_7-2.png" width="672" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="chapter8.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="do">## dev.print(pdf, file = &quot;ex66b.pdf&quot;)</span></span>
<span id="cb64-2"><a href="chapter8.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="do">## plot.Gam(gam1, se = TRUE, col = &quot;red&quot;) # produces a bit messier graphs</span></span>
<span id="cb64-3"><a href="chapter8.html#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="chapter8.html#cb64-4" aria-hidden="true" tabindex="-1"></a>gam2 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(year, <span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">s</span>(age, <span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education, <span class="at">data =</span> Wage)</span>
<span id="cb64-5"><a href="chapter8.html#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gam2)</span></code></pre></div>
<pre><code>## 
## Call: gam(formula = wage ~ s(year, df = 4) + s(age, df = 5) + education, 
##     data = Wage)
## Deviance Residuals:
##     Min      1Q  Median      3Q     Max 
## -119.43  -19.70   -3.33   14.17  213.48 
## 
## (Dispersion Parameter for gaussian family taken to be 1235.69)
## 
##     Null Deviance: 5222086 on 2999 degrees of freedom
## Residual Deviance: 3689770 on 2986 degrees of freedom
## AIC: 29887.75 
## 
## Number of Local Scoring Iterations: NA 
## 
## Anova for Parametric Effects
##                   Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## s(year, df = 4)    1   27162   27162  21.981 2.877e-06 ***
## s(age, df = 5)     1  195338  195338 158.081 &lt; 2.2e-16 ***
## education          4 1069726  267432 216.423 &lt; 2.2e-16 ***
## Residuals       2986 3689770    1236                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Anova for Nonparametric Effects
##                 Npar Df Npar F  Pr(F)    
## (Intercept)                              
## s(year, df = 4)       3  1.086 0.3537    
## s(age, df = 5)        4 32.380 &lt;2e-16 ***
## education                                
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="chapter8.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot(gam2, se = TRUE, col = &quot;red&quot;) # calls plot.Gam, again does not work </span></span>
<span id="cb66-2"><a href="chapter8.html#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb66-3"><a href="chapter8.html#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam2, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">30</span>), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb66-4"><a href="chapter8.html#cb66-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;f(year)&quot;</span>, <span class="at">terms =</span> <span class="fu">attr</span>(gam2<span class="sc">$</span>terms, <span class="at">which =</span> <span class="st">&quot;term.labels&quot;</span>)[<span class="dv">1</span>])</span>
<span id="cb66-5"><a href="chapter8.html#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam2, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">30</span>), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb66-6"><a href="chapter8.html#cb66-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;f(age)&quot;</span>, <span class="at">terms =</span> <span class="fu">attr</span>(gam2<span class="sc">$</span>terms, <span class="at">which =</span> <span class="st">&quot;term.labels&quot;</span>)[<span class="dv">2</span>])</span>
<span id="cb66-7"><a href="chapter8.html#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam2, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">30</span>), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb66-8"><a href="chapter8.html#cb66-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;f(education)&quot;</span>, <span class="at">terms =</span> <span class="fu">attr</span>(gam2<span class="sc">$</span>terms, <span class="at">which =</span> <span class="st">&quot;term.labels&quot;</span>)[<span class="dv">3</span>])</span></code></pre></div>
<p><img src="ILR_files/figure-html/ch8_7-3.png" width="672" /></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="chapter8.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="do">## dev.print(pdf, file = &quot;ex66c.pdf&quot;)</span></span>
<span id="cb67-2"><a href="chapter8.html#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co">#help(lo)</span></span>
<span id="cb67-3"><a href="chapter8.html#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb67-4"><a href="chapter8.html#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="do">## testing the effect of year on wage</span></span>
<span id="cb67-5"><a href="chapter8.html#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb67-6"><a href="chapter8.html#cb67-6" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(age, <span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education, <span class="at">data =</span> Wage) <span class="co"># year removed</span></span>
<span id="cb67-7"><a href="chapter8.html#cb67-7" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">s</span>(age, <span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education, <span class="at">data =</span> Wage) <span class="co"># year&#39;s linear effect</span></span>
<span id="cb67-8"><a href="chapter8.html#cb67-8" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(year, <span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">s</span>(age, <span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education, <span class="at">data =</span> Wage) <span class="co"># same as gam2</span></span>
<span id="cb67-9"><a href="chapter8.html#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m1, m2, m3, <span class="at">test =</span> <span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: wage ~ s(age, df = 5) + education
## Model 2: wage ~ year + s(age, df = 5) + education
## Model 3: wage ~ s(year, df = 4) + s(age, df = 5) + education
##   Resid. Df Resid. Dev Df Deviance       F    Pr(&gt;F)    
## 1      2990    3711731                                  
## 2      2989    3693842  1  17889.2 14.4771 0.0001447 ***
## 3      2986    3689770  3   4071.1  1.0982 0.3485661    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><br></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter7.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter9.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ILR.pdf", "ILR.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
