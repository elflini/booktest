<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 비모수적 생존함수 추정 | Survival Analysis</title>
  <meta name="description" content="This is a manual for Survival Analysis" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 비모수적 생존함수 추정 | Survival Analysis" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a manual for Survival Analysis" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 비모수적 생존함수 추정 | Survival Analysis" />
  
  <meta name="twitter:description" content="This is a manual for Survival Analysis" />
  

<meta name="author" content="Jin Hyun Nam" />


<meta name="date" content="2023-03-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter1.html"/>
<link rel="next" href="chapter3.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Survival Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>머리말</a></li>
<li class="chapter" data-level="1" data-path="chapter1.html"><a href="chapter1.html"><i class="fa fa-check"></i><b>1</b> Survival Analysis?</a>
<ul>
<li class="chapter" data-level="1.1" data-path="chapter1.html"><a href="chapter1.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="chapter1.html"><a href="chapter1.html#basic-concept-of-study-design"><i class="fa fa-check"></i><b>1.2</b> Basic Concept of Study Design</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="chapter1.html"><a href="chapter1.html#study-designs"><i class="fa fa-check"></i><b>1.2.1</b> Study designs</a></li>
<li class="chapter" data-level="1.2.2" data-path="chapter1.html"><a href="chapter1.html#clinical-trials"><i class="fa fa-check"></i><b>1.2.2</b> Clinical trials</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="chapter1.html"><a href="chapter1.html#중도절단censoring"><i class="fa fa-check"></i><b>1.3</b> 중도절단(Censoring)</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="chapter1.html"><a href="chapter1.html#right-censoring"><i class="fa fa-check"></i><b>1.3.1</b> Right censoring</a></li>
<li class="chapter" data-level="1.3.2" data-path="chapter1.html"><a href="chapter1.html#left-censoring"><i class="fa fa-check"></i><b>1.3.2</b> Left censoring</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="chapter1.html"><a href="chapter1.html#failure-time-distribution"><i class="fa fa-check"></i><b>1.4</b> Failure Time Distribution</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="chapter1.html"><a href="chapter1.html#생존함수survival-function"><i class="fa fa-check"></i><b>1.4.1</b> 생존함수(survival function)</a></li>
<li class="chapter" data-level="1.4.2" data-path="chapter1.html"><a href="chapter1.html#continuous-survival-time"><i class="fa fa-check"></i><b>1.4.2</b> Continuous survival time</a></li>
<li class="chapter" data-level="1.4.3" data-path="chapter1.html"><a href="chapter1.html#discrete-survival-time"><i class="fa fa-check"></i><b>1.4.3</b> Discrete survival time</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter2.html"><a href="chapter2.html"><i class="fa fa-check"></i><b>2</b> 비모수적 생존함수 추정</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter2.html"><a href="chapter2.html#누적한계추정법"><i class="fa fa-check"></i><b>2.1</b> 누적한계추정법</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="chapter2.html"><a href="chapter2.html#분산-추정량---greenwoods-estimate-of-varhatst"><i class="fa fa-check"></i><b>2.1.1</b> 분산 추정량 - Greenwood’s estimate of <span class="math inline">\(Var(\hat{S}(t))\)</span></a></li>
<li class="chapter" data-level="2.1.2" data-path="chapter2.html"><a href="chapter2.html#r-예제"><i class="fa fa-check"></i><b>2.1.2</b> R 예제</a></li>
<li class="chapter" data-level="2.1.3" data-path="chapter2.html"><a href="chapter2.html#sas-예제"><i class="fa fa-check"></i><b>2.1.3</b> SAS 예제</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="chapter2.html"><a href="chapter2.html#생명표-방법"><i class="fa fa-check"></i><b>2.2</b> 생명표 방법</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="chapter2.html"><a href="chapter2.html#sas-예제-1"><i class="fa fa-check"></i><b>2.2.1</b> SAS 예제</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="chapter2.html"><a href="chapter2.html#생존분포-비교"><i class="fa fa-check"></i><b>2.3</b> 생존분포 비교</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="chapter2.html"><a href="chapter2.html#r-예제-1"><i class="fa fa-check"></i><b>2.3.1</b> R 예제</a></li>
<li class="chapter" data-level="2.3.2" data-path="chapter2.html"><a href="chapter2.html#sas-예제-2"><i class="fa fa-check"></i><b>2.3.2</b> SAS 예제</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter3.html"><a href="chapter3.html"><i class="fa fa-check"></i><b>3</b> Cox 비례위험모형(PH model)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter3.html"><a href="chapter3.html#cox-ph-model"><i class="fa fa-check"></i><b>3.1</b> Cox PH model</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="chapter3.html"><a href="chapter3.html#위험비hazard-ratio-계산"><i class="fa fa-check"></i><b>3.1.1</b> 위험비(hazard ratio) 계산</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="chapter3.html"><a href="chapter3.html#콕스-ph-모형을-이용한-보정된-생존곡선"><i class="fa fa-check"></i><b>3.2</b> 콕스 PH 모형을 이용한 보정된 생존곡선</a></li>
<li class="chapter" data-level="3.3" data-path="chapter3.html"><a href="chapter3.html#비례위험-가정-평가"><i class="fa fa-check"></i><b>3.3</b> 비례위험 가정 평가</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="chapter3.html"><a href="chapter3.html#그래프를-이용하는-방법"><i class="fa fa-check"></i><b>3.3.1</b> 그래프를 이용하는 방법</a></li>
<li class="chapter" data-level="" data-path="chapter3.html"><a href="chapter3.html#로그-로그-생존곡선-그림"><i class="fa fa-check"></i>로그-로그 생존곡선 그림</a></li>
<li class="chapter" data-level="3.3.2" data-path="chapter3.html"><a href="chapter3.html#적합도-검정"><i class="fa fa-check"></i><b>3.3.2</b> 적합도 검정</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="chapter3.html"><a href="chapter3.html#시간의존-공변량"><i class="fa fa-check"></i><b>3.4</b> 시간의존 공변량</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter4.html"><a href="chapter4.html"><i class="fa fa-check"></i><b>4</b> 경쟁위험(Competing Risks)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chapter4.html"><a href="chapter4.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="chapter4.html"><a href="chapter4.html#경쟁위험"><i class="fa fa-check"></i><b>4.2</b> 경쟁위험</a></li>
<li class="chapter" data-level="4.3" data-path="chapter4.html"><a href="chapter4.html#원인별-누적발생함수"><i class="fa fa-check"></i><b>4.3</b> 원인별 누적발생함수</a></li>
<li class="chapter" data-level="4.4" data-path="chapter4.html"><a href="chapter4.html#누적조건부확률함수"><i class="fa fa-check"></i><b>4.4</b> 누적조건부확률함수</a></li>
<li class="chapter" data-level="4.5" data-path="chapter4.html"><a href="chapter4.html#누적발생함수-비교"><i class="fa fa-check"></i><b>4.5</b> 누적발생함수 비교</a></li>
<li class="chapter" data-level="4.6" data-path="chapter4.html"><a href="chapter4.html#cause-specific-hazard-chs-model"><i class="fa fa-check"></i><b>4.6</b> Cause-specific hazard (CHS) model</a></li>
<li class="chapter" data-level="4.7" data-path="chapter4.html"><a href="chapter4.html#fine-and-gray-subdistribution-model"><i class="fa fa-check"></i><b>4.7</b> Fine and Gray (subdistribution) model</a></li>
<li class="chapter" data-level="4.8" data-path="chapter4.html"><a href="chapter4.html#proportional-odds-model-using-cpf"><i class="fa fa-check"></i><b>4.8</b> Proportional odds model (using CPF)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter5.html"><a href="chapter5.html"><i class="fa fa-check"></i><b>5</b> 모수적 생존함수 추정</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter5.html"><a href="chapter5.html#지수분포"><i class="fa fa-check"></i><b>5.1</b> 지수분포</a></li>
<li class="chapter" data-level="5.2" data-path="chapter5.html"><a href="chapter5.html#와이블분포"><i class="fa fa-check"></i><b>5.2</b> 와이블분포</a></li>
<li class="chapter" data-level="5.3" data-path="chapter5.html"><a href="chapter5.html#감마분포"><i class="fa fa-check"></i><b>5.3</b> 감마분포</a></li>
<li class="chapter" data-level="5.4" data-path="chapter5.html"><a href="chapter5.html#로그정규분포"><i class="fa fa-check"></i><b>5.4</b> 로그정규분포</a></li>
<li class="chapter" data-level="5.5" data-path="chapter5.html"><a href="chapter5.html#로그로지스틱분포"><i class="fa fa-check"></i><b>5.5</b> 로그로지스틱분포</a></li>
<li class="chapter" data-level="5.6" data-path="chapter5.html"><a href="chapter5.html#곰페르츠분포"><i class="fa fa-check"></i><b>5.6</b> 곰페르츠분포</a></li>
<li class="chapter" data-level="5.7" data-path="chapter5.html"><a href="chapter5.html#가속실패시간모형aft"><i class="fa fa-check"></i><b>5.7</b> 가속실패시간모형(AFT)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter6.html"><a href="chapter6.html"><i class="fa fa-check"></i><b>6</b> 기타 이슈</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter6.html"><a href="chapter6.html#aic-and-bic"><i class="fa fa-check"></i><b>6.1</b> AIC and BIC</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="chapter6.html"><a href="chapter6.html#visual-inspection"><i class="fa fa-check"></i><b>6.1.1</b> Visual inspection</a></li>
<li class="chapter" data-level="6.1.2" data-path="chapter6.html"><a href="chapter6.html#aic-akaike-information-criterion"><i class="fa fa-check"></i><b>6.1.2</b> AIC (Akaike information criterion)</a></li>
<li class="chapter" data-level="6.1.3" data-path="chapter6.html"><a href="chapter6.html#bic"><i class="fa fa-check"></i><b>6.1.3</b> BIC</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="chapter6.html"><a href="chapter6.html#추정방법에-따른-차이"><i class="fa fa-check"></i><b>6.2</b> 추정방법에 따른 차이</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="chapter6.html"><a href="chapter6.html#piecewise"><i class="fa fa-check"></i><b>6.2.1</b> Piecewise</a></li>
<li class="chapter" data-level="6.2.2" data-path="chapter6.html"><a href="chapter6.html#splines"><i class="fa fa-check"></i><b>6.2.2</b> Splines</a></li>
<li class="chapter" data-level="6.2.3" data-path="chapter6.html"><a href="chapter6.html#mixture-cured-model"><i class="fa fa-check"></i><b>6.2.3</b> Mixture cured model</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="chapter6.html"><a href="chapter6.html#crossover-treatment-switching"><i class="fa fa-check"></i><b>6.3</b> Crossover / Treatment switching</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="chapter6.html"><a href="chapter6.html#crossover-보정방법"><i class="fa fa-check"></i><b>6.3.1</b> Crossover 보정방법</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Survival Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter2" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> 비모수적 생존함수 추정<a href="chapter2.html#chapter2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><img src="survival2/f6.png" /></p>
<p><br></p>
<ul>
<li><p>생존시간의 분포를 특정하지 않는 경우 비모수적 방법(nonparameteric
method)으로 생존 함수 추정 가능</p></li>
<li><p>중도절단이 없는 경우, 생존시간 <span class="math inline">\(x_1, \ldots, x_n\)</span>을 순서대로 배열한
것을 <span class="math inline">\(t_1&lt;t_2&lt;\cdots&lt;t_n\)</span>이라 하면 경험적 분포함수 (empirical distribution function)</p></li>
</ul>
<p><span class="math display">\[
            S(t_i) = P(T&gt;t_i)
            = \text{생존시간이 } t_i \text{이상인 관측치수} / \text{총 관측치수}
            = 1- t_i \text{까지의 사망자수} / n
\]</span></p>
<ul>
<li><p>경험적 분포함수를 중단절단자료가 있는 경우로 확장한 방법이
생명표(life table)를 이용한 방법과 누적한계추정법(product-limit
method)</p></li>
<li><p>생명표 방법은 시간의 단위로 묶어서 생존함수를 추정하며,
누적한계추정법은 환자 개개인의 생존시간을 관측하여 각 시점에서의
생존함수를 추정</p></li>
</ul>
<p><br></p>
<div id="누적한계추정법" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> 누적한계추정법<a href="chapter2.html#누적한계추정법" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>생존함수를 추정하는 대표적인 방법 중 하나로 연구자의 이름을 따서
카플란-마미어(Kaplan-Meier) 추정법이라고도 함</li>
</ul>
<blockquote>
<blockquote>
<p>Notation</p>
</blockquote>
</blockquote>
<ul>
<li><p>Sample of <span class="math inline">\(n_0\)</span> from <span class="math inline">\(F\)</span>
<span class="math display">\[
0=t_0&lt;t_1&lt;t_2&lt;\cdots &lt;t_k&lt;t_{k+1}=\infty
\]</span>
      are failure time (uncensored)</p></li>
<li><p><span class="math inline">\(d_j\)</span> subjects fail at <span class="math inline">\(t_j\)</span></p></li>
</ul>
<p><img src="survival_add/f25.png" /></p>
<ul>
<li># at risk of failure at time just before <span class="math inline">\(t_j\)</span>
<span class="math display">\[
n_j=\sum_{i=j}^k(m_i+d_i)
\]</span></li>
</ul>
<blockquote>
<blockquote>
<p>Assume</p>
</blockquote>
</blockquote>
<ul>
<li><p>The censoring time <span class="math inline">\(t_{jl}\)</span> tells us only that the corresponding failure time is <span class="math inline">\(&gt;t_{jl}\)</span> (i.e., the contribution to the likelihood of a survival time censored at <span class="math inline">\(t_{jl}\)</span> is <span class="math inline">\(P(T&gt;t_{jl})=S(t_{jl}+0))\)</span></p></li>
<li><p>The likelihood of <span class="math inline">\(S\)</span> (survival function) is</p></li>
</ul>
<p><span class="math display">\[
L(S)=\prod_{j=0}^k \bigg \{[S(t_j)-S(t_j+0)]^{d_{j}}\prod_{l=1}^{m_j}S(t_{jl}+0)\bigg\}
\]</span></p>
<p>      <span class="math inline">\(S(t_j)-S(t_j+0)\)</span>: the probability of failure at time <span class="math inline">\(t_j\)</span></p>
<p>      <span class="math inline">\(S(t_{jl}+0)=Pr(T&gt;t_{jl})\)</span>: the contribution to the likelihood of a survival time censored at <span class="math inline">\(t_{jl}\)</span></p>
<ul>
<li><p>MLE of <span class="math inline">\(S\)</span> is <span class="math inline">\(\hat{S}\)</span> such that <span class="math inline">\(L(\hat{S})\)</span> is max</p></li>
<li><p>The maximum likelihood estimate <span class="math inline">\(\hat{S}\)</span> of <span class="math inline">\(F\)</span> will maximized <span class="math inline">\(L(\hat{S})\)</span></p></li>
<li><p>Clearly we want <span class="math inline">\(S(t_j)-S(t_j+0)&gt;0\)</span> (i.e., jump at <span class="math inline">\(t_j\)</span>) (*) otherwise <span class="math inline">\(L(\hat{S})=0\)</span></p></li>
<li><p>Any <span class="math inline">\(\hat{F}\)</span> satisfies (*), <span class="math inline">\(L(\hat{F})\)</span> is maximized by taking</p></li>
</ul>
<p><span class="math display">\[
\hat{S}(t_{jl}+0)=\hat{S}(t_j+0)=\hat{S}(t_{j+1})
\]</span></p>
<p>      jump on only at time <span class="math inline">\(t_{j+1}\)</span> not censored time <span class="math inline">\(\rightarrow \hat{S}(t_{0l})=1\)</span>)</p>
<ul>
<li>MLE <span class="math inline">\(\hat{S}\)</span> is a <strong>discrete survival function</strong> with jump points <span class="math inline">\(t_j\)</span></li>
</ul>
<blockquote>
<blockquote>
<p>Proof</p>
</blockquote>
</blockquote>
<ul>
<li>Let <span class="math inline">\(\hat{\lambda}\)</span> be the hazard function for <span class="math inline">\(\hat{S}\)</span></li>
</ul>
<p><span class="math display">\[
1-\hat{\lambda}_j = \frac{\hat{S}(t_{j+1})}{\hat{S}(t_{j})}=\frac{\hat{S}(t_j+0)}{\hat{S}(t_{j})}
\]</span></p>
<p>      <span class="math inline">\(\lambda(t)=Pr(T=t|T\ge t)\)</span></p>
<p><span class="math display">\[
\begin{aligned}
1-\lambda(t)&amp;=1-Pr(T=t|T\ge t)\\
&amp;=Pr(T\ge t+1|T \ge t)\\
&amp;=\frac{S(t+0)}{S(t)}
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\hat{\lambda}_j = \frac{\hat{S}(t_{j})-\hat{S}(t_j+0)}{\hat{S}(t_{j})}=\frac{\hat{f}(t_j)}{\hat{S}(t_{j})}
\]</span></p>
<ul>
<li><p><span class="math inline">\(\hat{S}(t_{j})-\hat{S}(t_j+0)=\hat{\lambda}_j\hat{F}(t_j)=\hat{\lambda}_j\prod_{i&lt;j}(1-\hat{\lambda}_i)\)</span>, <span class="math inline">\(\hat{S}(t_{j+1})=\prod_{i=1}^j(1-\hat{\lambda}_i)\)</span></p></li>
<li><p>Now plug in (*) into <span class="math inline">\(L(\hat{F})\)</span> and expand completely</p></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
L(\hat{S})&amp;=\prod_{j=0}^k \bigg \{[\hat{S}(t_j)-\hat{S}(t_j+0)]^{d_{j}}\prod_{l=1}^{m_j}\hat{S}(t_{jl}+0)\bigg\} \\
&amp;=\prod_{j=0}^k \bigg \{[\hat{S}(t_j)-\hat{S}(t_j+0)]^{d_{j}}[\hat{S}(t_{j}+0)]^{m_j}\bigg\} \\
&amp;=\prod_{j=1}^k \bigg \{[\hat{\lambda}_j\hat{S}(t_j)]^{d_{j}}[(1-\hat{\lambda})\hat{S}(t_{j}+0)]^{m_j}\bigg\} \\
&amp;=\prod_{j=1}^k \bigg \{\hat{\lambda}_j^{d_j}(1-\hat{\lambda})^{m_j}\hat{S}(t_j)^{d_{j}+m_j}\bigg\} \\
&amp;=\prod_{j=1}^k \bigg \{\hat{\lambda}_j^{d_j}(1-\hat{\lambda})^{m_j}\prod_{i=0}^{j-1}(1-\hat{\lambda}_j)^{d_{j}+m_j}\bigg\} \\
&amp; \,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, \vdots \\
&amp;=\prod_{j=1}^k \hat{\lambda}_j^{d_j}(1-\hat{\lambda})^{n_j - d_j}
\end{aligned}
\]</span></p>
<ul>
<li>What <span class="math inline">\(\hat{\lambda}_j\)</span> that maximizes <span class="math inline">\(L(\hat{F})\)</span> is maximized when</li>
</ul>
<p><span class="math display">\[
\hat{\lambda}_j = \frac{d_j}{n_j}
\]</span></p>
<ul>
<li><p>Maximum likelihood estimate of <span class="math inline">\(S\)</span> is <span class="math inline">\(\hat{S}=\prod_{j, t_j&lt;t}(1-\hat{\lambda}_j)\)</span></p></li>
<li><p><strong>Kaplan-Meier estimator</strong> or Product limit estimator of survival function</p></li>
</ul>
<p><span class="math display">\[
\hat{S}=\prod_{j, t_j&lt;t}(1-\hat{\lambda}_j)=\prod_{j, t_j&lt;t}(1-\frac{d_j}{n_j})
\]</span></p>
<p><img src="survival_add/f26.png" /></p>
<p><span class="math display">\[
\begin{aligned}
S(t)&amp;=Pr(T\ge t) \\
&amp;= Pr(T\ge t|T\ge t_{j-1})\cdot Pr(T\ge t_{j-1}) \\
&amp;= \frac{n_j-d_j}{n_j}\cdot Pr(T\ge t_{j-1})\\
&amp;= \prod_{j, t_j&lt;t}\bigg(1-\frac{d_j}{n_j}\bigg)
\end{aligned}
\]</span></p>
<ul>
<li>Conditional probability</li>
</ul>
<p><span class="math display">\[
\frac{n_j-d_j}{n_j}=\frac{\#\,\,\, of\,\,\, individuals \,\,\, at\,\,\, risk\,\,\, at\,\,\, time\,\,\, t_{(j)}}{\#\,\,\, of\,\,\, individuals \,\,\, at\,\,\, risk\,\,\, at\,\,\, time\,\,\, t_{(j-1)}}
\]</span></p>
<p>      We get</p>
<p><span class="math display">\[
d_j \sim bin(n_j, \hat{\lambda}_j)
\]</span></p>
<p>      where <span class="math inline">\(\hat{\lambda}_j=\frac{d_j}{n_j}\)</span></p>
<blockquote>
<blockquote>
<p>Note</p>
</blockquote>
</blockquote>
<ol style="list-style-type: decimal">
<li>If there is no censoring and no ties in the data (i.e., <span class="math inline">\(n_i=n_{i-1}-d_{i-1}\)</span>)</li>
</ol>
<p><span class="math display">\[
\hat{S}(t)=\frac{\#(t_i\ge t)}{n_0}
\]</span></p>
<p>      empirical survival function (step function)</p>
<ol start="2" style="list-style-type: decimal">
<li>Setting - no censoring and no ties (<span class="math inline">\(n_i=n_{i-1}-d_{i-1}\)</span>)</li>
</ol>
<p><span class="math display">\[
\hat{S}(t)=\frac{n_0-d_0}{n_0} \cdot \frac{n_1-d_1}{n_1} \cdot \, \cdots \, \cdot \frac{n_j-d_j}{n_j}=\frac{n_j-d_j}{n_0}
\]</span></p>
<p>      <span class="math inline">\(\hat{\lambda}_j=\frac{d_j}{n_j}\)</span> is equivalent to</p>
<p><span class="math display">\[
\hat{\lambda}_j=Pr(T=t_j|T\ge t_j)=\frac{\#\,\,\,of\,\,\, failure\,\,\, at\,\,\, t_j}{\#\,\,\,of\,\,\, risk\,\,\, at\,\,\, t_j^-}
\]</span></p>
<ol start="3" style="list-style-type: decimal">
<li><p>KME is a discrete measure giving mass only to the uncensored observations</p></li>
<li><p>KME is step function</p></li>
</ol>
<p>      - It jumps at death times</p>
<p>      - No changes at censored observations</p>
<ul>
<li><p>Censoring observations do not contribute to compute <span class="math inline">\(\hat{\lambda}_j\)</span></p></li>
<li><p>For breaking ties</p></li>
</ul>
<ol style="list-style-type: decimal">
<li><p>If a censored observations is tied with an uncensored observation, we consider the censored observations &gt; the uncensored observations</p></li>
<li><p>If two uncensored observations or two censored observations are tied then we break them arbitrary by an infinitesimal distance</p></li>
</ol>
<p><img src="survival_add/f27.png" /></p>
<ul>
<li><p>생존시간 또는 중도절단시간 <span class="math inline">\(x_1, \ldots, x_n\)</span>을 순서대로 배열한 것을
<span class="math inline">\(t_1&lt;t_2&lt;\cdots&lt;t_n\)</span>이라 하고 <span class="math inline">\(\delta_i\)</span>를 생존시간 <span class="math inline">\(t_i\)</span>의
중도절단여부를 표현. 이때 중도절단인 경우 <span class="math inline">\(\delta_i=0\)</span>, 그렇지 않은
경우 <span class="math inline">\(\delta_i=1\)</span></p></li>
<li><p>시점 <span class="math inline">\(t_i\)</span>에서 위험에 노출된 인원수, 즉 <span class="math inline">\(t_i\)</span> 바로 직전까지
중도절단되지 않고 생존해 있던 인원수를 <span class="math inline">\(n_i\)</span>라고 하고 사망한 사람의
수를 <span class="math inline">\(d_i\)</span>라고 했을 때 생존함수 <span class="math inline">\(S(t)\)</span>의 누적한계추정량은</p></li>
</ul>
<p><span class="math display">\[
\hat{S}(t)=\prod_{t_i\le t} (1-d_i/n_i)^{\delta_i}
\]</span></p>
<ul>
<li><p>누정한계추정량은 중도절단시간에서는 변하지 않고 사망이 관측되는 시점
<span class="math inline">\(x_i\)</span>에서 <span class="math inline">\((n_i-d_i)/n_i\)</span>를 곱해준 만큼씩 감소하는 계단함수</p></li>
<li><p>중도절단의 효과는 각 단계에서의 크기 <span class="math inline">\(n_i\)</span>의 값에서 나타남</p></li>
<li><p>사망시간과 중도절단시간이 동일한 경우에는 사망이 중도절단보다 먼저
관측되었다고 판단</p></li>
<li><p>마지막 생존시간 <span class="math inline">\(t_n\)</span>이 중도절단된 경우에는 <span class="math inline">\(t_n\)</span> 이상의 기간에
대해서는 누적한계추정값을 정의하지 않음</p></li>
</ul>
<div id="분산-추정량---greenwoods-estimate-of-varhatst" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> 분산 추정량 - Greenwood’s estimate of <span class="math inline">\(Var(\hat{S}(t))\)</span><a href="chapter2.html#분산-추정량---greenwoods-estimate-of-varhatst" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display">\[
\hat{Var}(\hat{S}(t))=\hat{S}^2(t)\sum_{i:t_i\le t} \frac{d_i}{n_i(n_i-d_i)}
\]</span></p>
<div id="delta-delta-method" class="section level4 hasAnchor" number="2.1.1.1">
<h4><span class="header-section-number">2.1.1.1</span> Delta (<span class="math inline">\(\delta\)</span>) method<a href="chapter2.html#delta-delta-method" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Suppose <span class="math inline">\(\hat{\theta}\)</span> is an estimator of <span class="math inline">\(\theta\)</span></p></li>
<li><p><span class="math inline">\(g(\theta)\)</span> is the parameter of interest</p></li>
<li><p>Assume <span class="math inline">\(g(\cdot)\)</span> is a differentiable function</p></li>
<li><p><span class="math inline">\(g(\hat{\theta})\)</span> is an estimator of <span class="math inline">\(g(\theta)\)</span></p></li>
</ul>
<p><span class="math display">\[
g(\hat{\theta})-g(\theta)=g&#39;(\theta)(\hat{\theta}-\theta)+o(|\hat{\theta}-\theta|)
\]</span></p>
<ul>
<li><p>Usually <span class="math inline">\(\sqrt{n}(\hat\theta -\theta) \rightarrow^d N(0, \sigma^2)\)</span></p></li>
<li><p>So <span class="math inline">\(Var(g(\hat{\theta})) \approx (g&#39;(\hat{\theta}))^2Var(\hat{\theta})\)</span></p></li>
</ul>
<p><img src="survival_add/f28.png" /></p>
</div>
<div id="heuristic-derivation-of-greenwoods-estimate-of-sigma_hatst2" class="section level4 hasAnchor" number="2.1.1.2">
<h4><span class="header-section-number">2.1.1.2</span> Heuristic derivation of Greenwood’s estimate of <span class="math inline">\(\sigma_{\hat{S}(t)}^2\)</span><a href="chapter2.html#heuristic-derivation-of-greenwoods-estimate-of-sigma_hatst2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Under some regularity conditions</li>
</ul>
<p><span class="math display">\[
\hat{F}(t)=\prod_{j, t_j&lt;t}(1-\frac{d_j}{n_j})\sim AN(F(t),\sigma_{\hat{S}(t)}^2)
\]</span></p>
</div>
<div id="delta-method" class="section level4 unnumbered hasAnchor">
<h4><span class="math inline">\(\delta\)</span>-method<a href="chapter2.html#delta-method" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Suppose <span class="math inline">\(T_n \sim AN(\mu, \sigma_n^2)\)</span> with <span class="math inline">\(\sigma_n \rightarrow 0\)</span></p></li>
<li><p>Let <span class="math inline">\(g\)</span> be a real-valued function differentiable at <span class="math inline">\(t=\mu\)</span>, with <span class="math inline">\(g&#39;(\mu)\ne 0\)</span></p></li>
<li><p>Then <span class="math inline">\(g(T_n)\sim AN(g(\mu), [g&#39;(\mu)]^2\sigma_n^2)\)</span></p></li>
</ul>
<p><span class="math display">\[
\hat{S}(t)=\prod_{j, t_j&lt;t}(1-\hat{\lambda}_j)
\]</span></p>
<ul>
<li><span class="math inline">\(log\hat{S}(t)=\sum_{j, t_j&lt;t}log(1-\hat{\lambda}_j)\)</span>: sum is easier to calculate</li>
</ul>
<p><span class="math display">\[
Var(log\hat{S}(t))=\sum_{j, t_j&lt;t}Var(log(1-\hat{\lambda}_j))+cov
\]</span></p>
<ul>
<li><p>If we assume independence then <span class="math inline">\(Cov=0\)</span></p></li>
<li><p><span class="math inline">\(1-\hat{\lambda}_j\sim AN(1-\lambda_j, \frac{\lambda_j(1-\lambda_j)}{n_j})\)</span></p></li>
</ul>
<p><span class="math display">\[
log(1-\hat{\lambda}_j)\sim AN(log(1-\lambda_j),(-\frac{1}{1-\lambda_j})^2 \frac{\lambda_j(1-\lambda_j)}{n_j})
\]</span></p>
<p><span class="math display">\[
i.e., \,\,\, log(1-\hat{\lambda}_j)\sim AN(log(1-\lambda_j),(\frac{\lambda_j}{n_j(1-\lambda_j)})
\]</span></p>
<ul>
<li><span class="math inline">\(Var(log\hat{S}(t))=\sum_{j, t_j&lt;t}\frac{\lambda_j}{n_j(1-\lambda_j)}\)</span></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\hat{Var}(log\hat{S}(t))&amp;=\sum_{j, t_j&lt;t}\frac{\hat\lambda_j}{n_j(1-\hat\lambda_j)} \\
&amp;= \sum_{j, t_j&lt;t}\frac{d_j}{n_j(n_j-d_j)}
\end{aligned}
\]</span></p>
<ul>
<li><span class="math inline">\(\hat{S}(t)=e^{log\hat{S}(t)}\)</span></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
Var(log\hat{S}(t))&amp;=(e^{log{S}(t)})^2\sum_{j, t_j&lt;t}\frac{\lambda_j}{n_j(1-\lambda_j)} \\
&amp;= (S(t))^2\sum_{j, t_j&lt;t}\frac{\lambda_j}{n_j(1-\lambda_j)}
\end{aligned}
\]</span></p>
<ul>
<li><p><span class="math inline">\(\hat{Var}(\hat{S}(t))=(\hat{S}(t))^2\sum_{j, t_j&lt;t}\frac{\hat{\lambda}_j}{n_j(1-\hat{\lambda}_j)}\)</span></p></li>
<li><p>Greenwood’s Formula (Crowley &amp; Breslow 1974, Annals of Staitsitcs)</p></li>
</ul>
<p><span class="math display">\[
\hat{Var}(\hat{S}(t))=(\hat{S}(t))^2\sum_{j, t_j&lt;t}\frac{d_j}{n_j(n_j-d_j)}
\]</span></p>
<ul>
<li><span class="math inline">\(\hat{S}(t)\sim AN(S(t), \hat{Var}(\hat{S}(t))\)</span> so,</li>
</ul>
<p><span class="math display">\[
\frac{\hat{S}(t)-S(t)}{\sqrt{Var(\hat{F}(t))}}\rightarrow^d N(0,1)
\]</span></p>
<ul>
<li><span class="math inline">\(100(1-\alpha)\%\)</span> CI for <span class="math inline">\(S(t)\)</span></li>
</ul>
<p><span class="math display">\[
\hat{S}(t) \pm z_{\alpha/2}\sqrt{\hat{Var}(\hat{S}(t))}
\]</span></p>
<ul>
<li><p>Problem: Bounds may be outside <span class="math inline">\([0,1]\)</span> (<span class="math inline">\(0&lt;\hat{S}(t)&lt;1\)</span>)</p></li>
<li><p>누정한계추정량은 일치성(consistency)과 근사적 정규성(asymptotic
normality)을 만족하는 등 표본이 클 때 통계적 성질이 우수함</p></li>
<li><p>자료 표현법</p></li>
</ul>
<p><img src="survival/ex5.jpg" style="width:80.0%" /></p>
<p><img src="survival/ex6.jpg" style="width:80.0%" /></p>
<ul>
<li>Example: Kaplan-Meier estimator for the 6 MP data (<span class="math inline">\(n=21\)</span>)</li>
</ul>
<p><img src="survival/ex01.jpg" /></p>
<ul>
<li>Example</li>
</ul>
<p><img src="survival/ex01.png" /></p>
</div>
</div>
<div id="r-예제" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> R 예제<a href="chapter2.html#r-예제" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- * 필요 패키지 로드 -->
<!-- ```{r, message=F} -->
<!-- library(autoReg) -->
<!-- library(survival) -->
<!-- library(survminer) -->
<!-- library(howto) -->
<!-- library(flextable) -->
<!-- library(ftExtra) -->
<!-- library(tidyverse) -->
<!-- ``` -->
<ul>
<li>autoReg 패키지에 포함되어 있는 anderson 데이터를 사용
<ul>
<li>42명의 백혈병 환자 데이터</li>
<li>time: week 단위</li>
<li>status: 재발은 1, 재발하지 않은 경우(중도절단의 경우)는 0</li>
<li>sex: 성별</li>
<li>logWBC: 백혈구 숫자의 로그값</li>
<li>rx: 치료군은 0, 대조군은 1</li>
</ul></li>
<li>설명의 편의를 위해 이 데이터 중 rx가 0인것만 골라 data라는 데이터 생성</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="chapter2.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(autoReg)</span>
<span id="cb1-2"><a href="chapter2.html#cb1-2" aria-hidden="true" tabindex="-1"></a>data<span class="ot">=</span><span class="fu">subset</span>(anderson,rx<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb1-3"><a href="chapter2.html#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="chapter2.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<pre><code>##   time status sex logWBC rx
## 1   35      0   1   1.45  0
## 2   34      0   1   1.47  0
## 3   32      0   1   2.20  0
## 4   32      0   1   2.53  0
## 5   25      0   1   1.78  0
## 6   23      1   1   2.57  0</code></pre>
<ul>
<li>생존분석은 다른 분석과는 달리 이벤트가 생기지 않은 모든 예에서 정확한 생존기간을 알 수 없기 때문에 모두 중도절단 자료로 취급함. 즉, 연구 종료 시까지 이벤트가 생기지 않고 종료된 경우나 추적실패(follow-up loss) 또는 중도탈락(drop-out)의 경우도 모두 절단된 데이터를 의미</li>
<li>이 데이터에서 time은 숫자로 되어 있으나 생존분석을 위해 중도절단된 자료에는 숫자에 ’+’를 붙여 중도절단임을 나타내야 함</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="chapter2.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb3-2"><a href="chapter2.html#cb3-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>time</span></code></pre></div>
<pre><code>##  [1] 35 34 32 32 25 23 22 20 19 17 16 13 11 10 10  9  7  6  6  6  6</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="chapter2.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(data,<span class="fu">Surv</span>(time,status))</span></code></pre></div>
<pre><code>##  [1] 35+ 34+ 32+ 32+ 25+ 23  22  20+ 19+ 17+ 16  13  11+ 10+ 10   9+  7   6+  6 
## [20]  6   6</code></pre>
<ul>
<li>평균생존시간(<span class="math inline">\(\bar{T}\)</span>)은 중도절단을 고려하지 않고 생존시간의 평균을 계산함
<ul>
<li>중도절단된 자료는 정확한 생존시간을 알 수 없으므로 실제 생존시간은 평균생존시간보다 길어짐</li>
<li>평균위험률(average hazard rate, <span class="math inline">\(\bar{h}\)</span>)은 전체 실패 수를 생존시간의 합계로 나눈 값</li>
</ul></li>
<li>다음은 anderson 데이터에서 치료군(rx)에 따라 평균생존시간과 평균 위험률을 계산한 값임</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="chapter2.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb7-2"><a href="chapter2.html#cb7-2" aria-hidden="true" tabindex="-1"></a>anderson <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="chapter2.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(rx) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="chapter2.html#cb7-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">T=</span><span class="fu">mean</span>(time),<span class="at">h=</span><span class="fu">sum</span>(status)<span class="sc">/</span><span class="fu">sum</span>(time))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##      rx     T      h
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1     0 17.1  0.0251
## 2     1  8.67 0.115</code></pre>
<ul>
<li><p>치료군(rx==0)에서 평균생존시간이 더 길고 평균위험률이 더 낮은 것을 알 수 있음</p></li>
<li><p>survfit함수를 쓰면 생존율을 계산해줌</p></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="chapter2.html#cb9-1" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>data)</span>
<span id="cb9-2"><a href="chapter2.html#cb9-2" aria-hidden="true" tabindex="-1"></a>fit</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(time, status) ~ 1, data = data)
## 
##       n events median 0.95LCL 0.95UCL
## [1,] 21      9     23      16      NA</code></pre>
<ul>
<li><p>출력결과에서 median survival과 95% 신뢰구간을 알 수 있음</p></li>
<li><p>Median survival time은 생존율이 50%인 시간을 의미하며, 각 시기별 생존율은 다음과 같음</p></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="chapter2.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(time, status) ~ 1, data = data)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     6     21       3    0.857  0.0764        0.720        1.000
##     7     17       1    0.807  0.0869        0.653        0.996
##    10     15       1    0.753  0.0963        0.586        0.968
##    13     12       1    0.690  0.1068        0.510        0.935
##    16     11       1    0.627  0.1141        0.439        0.896
##    22      7       1    0.538  0.1282        0.337        0.858
##    23      6       1    0.448  0.1346        0.249        0.807</code></pre>
<ul>
<li>각 시기별로 생존율과 생존율의 95% 신뢰구간을 알 수 있음. 생존율의 95% 신뢰구간은 다음과 같이 계산함</li>
</ul>
<p><span class="math display">\[
\hat{S}(t)\pm 1.96 \times \sqrt{\hat{Var}(\hat{S}(t))}
\]</span></p>
<ul>
<li>Mean survival time</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="chapter2.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(<span class="fu">summary</span>(fit))</span></code></pre></div>
<pre><code>## $n
## [1] 21
## 
## $time
## [1]  6  7 10 13 16 22 23
## 
## $n.risk
## [1] 21 17 15 12 11  7  6
## 
## $n.event
## [1] 3 1 1 1 1 1 1
## 
## $n.censor
## [1] 1 0 2 1 0 3 0
## 
## $surv
## [1] 0.8571429 0.8067227 0.7529412 0.6901961 0.6274510 0.5378151 0.4481793
## 
## $std.err
## [1] 0.07636035 0.08693529 0.09634965 0.10681471 0.11405387 0.12823375 0.13459146
## 
## $cumhaz
## [1] 0.1428571 0.2016807 0.2683473 0.3516807 0.4425898 0.5854469 0.7521136
## 
## $std.chaz
## [1] 0.08247861 0.10130611 0.12127396 0.14714557 0.17296323 0.22433110 0.27946775
## 
## $type
## [1] &quot;right&quot;
## 
## $logse
## [1] TRUE
## 
## $conf.int
## [1] 0.95
## 
## $conf.type
## [1] &quot;log&quot;
## 
## $lower
## [1] 0.7198171 0.6531242 0.5859190 0.5096131 0.4393939 0.3370366 0.2487882
## 
## $upper
## [1] 1.0000000 0.9964437 0.9675748 0.9347692 0.8959949 0.8582008 0.8073720
## 
## $call
## survfit(formula = Surv(time, status) ~ 1, data = data)
## 
## $table
##   records     n.max   n.start    events     rmean se(rmean)    median   0.95LCL 
## 21.000000 21.000000 21.000000  9.000000 23.287395  2.827468 23.000000 16.000000 
##   0.95UCL 
##        NA 
## 
## $rmean.endtime
## [1] 35</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="chapter2.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)<span class="sc">$</span>table</span></code></pre></div>
<pre><code>##   records     n.max   n.start    events     rmean se(rmean)    median   0.95LCL 
## 21.000000 21.000000 21.000000  9.000000 23.287395  2.827468 23.000000 16.000000 
##   0.95UCL 
##        NA</code></pre>
<ul>
<li><p>생존율을 계산하는 과정을 설명하기 위해 howto 패키지의 howto() 함수를 사용하여 계산과정을 살펴볼 수 있음</p></li>
<li><p>howto 패키지는 다음과 같이 install 함</p></li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="chapter2.html#cb17-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;cardiomoon/howto&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="chapter2.html#cb18-1" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>data)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="chapter2.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(howto)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;ftExtra&#39;:
##   method                  from     
##   as_flextable.data.frame flextable</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="chapter2.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable) <span class="do">## highlight function</span></span>
<span id="cb21-2"><a href="chapter2.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">howto</span>(fit) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="chapter2.html#cb21-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">highlight</span>(<span class="at">i=</span><span class="dv">1</span>,<span class="at">j=</span><span class="dv">6</span>,<span class="at">color=</span><span class="st">&quot;yellow&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="chapter2.html#cb21-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">highlight</span>(<span class="at">i=</span><span class="dv">2</span>,<span class="at">j=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>),<span class="at">color=</span><span class="st">&quot;yellow&quot;</span>)</span></code></pre></div>
<div class="tabwid"><style>.cl-f2bfe342{}.cl-f2b9b31e{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-f2b9b328{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:rgba(255, 255, 0, 1.00);}.cl-f2bc1faa{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-f2bc1fb4{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-f2bc2f72{width:0.574in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f73{width:0.65in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f74{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f7c{width:0.871in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f7d{width:1.444in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f7e{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f86{width:0.574in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f87{width:0.65in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f88{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f89{width:0.871in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f8a{width:1.444in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f90{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f91{width:0.574in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f9a{width:0.65in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f9b{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f9c{width:0.871in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f9d{width:1.444in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2f9e{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2fa4{width:0.574in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2fa5{width:0.65in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2fa6{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2fa7{width:0.871in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2fae{width:1.444in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f2bc2faf{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-f2bfe342'><thead><tr style="overflow-wrap:break-word;"><th class="cl-f2bc2f72"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">time</span></p></th><th class="cl-f2bc2f73"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">n.risk</span></p></th><th class="cl-f2bc2f74"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">n.event</span></p></th><th class="cl-f2bc2f7c"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">n.censor</span></p></th><th class="cl-f2bc2f7d"><p class="cl-f2bc1fb4"><span class="cl-f2b9b31e"> </span></p></th><th class="cl-f2bc2f7e"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">surv</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-f2bc2f86"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0</span></p></td><td class="cl-f2bc2f87"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">21</span></p></td><td class="cl-f2bc2f88"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0</span></p></td><td class="cl-f2bc2f89"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0</span></p></td><td class="cl-f2bc2f8a"><p class="cl-f2bc1fb4"><span class="cl-f2b9b31e"></span></p></td><td class="cl-f2bc2f90"><p class="cl-f2bc1faa"><span class="cl-f2b9b328">1.0000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-f2bc2f91"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">6</span></p></td><td class="cl-f2bc2f9a"><p class="cl-f2bc1faa"><span class="cl-f2b9b328">21</span></p></td><td class="cl-f2bc2f9b"><p class="cl-f2bc1faa"><span class="cl-f2b9b328">3</span></p></td><td class="cl-f2bc2f9c"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">1</span></p></td><td class="cl-f2bc2f9d"><p class="cl-f2bc1fb4"><span class="cl-f2b9b328">1.0000</span><span class="cl-f2b9b328"> × (18÷21)</span></p></td><td class="cl-f2bc2f9e"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0.8571</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-f2bc2f91"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">7</span></p></td><td class="cl-f2bc2f9a"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">17</span></p></td><td class="cl-f2bc2f9b"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">1</span></p></td><td class="cl-f2bc2f9c"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0</span></p></td><td class="cl-f2bc2f9d"><p class="cl-f2bc1fb4"><span class="cl-f2b9b31e">0.8571</span><span class="cl-f2b9b31e"> × (16÷17)</span></p></td><td class="cl-f2bc2f9e"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0.8067</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-f2bc2f91"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">10</span></p></td><td class="cl-f2bc2f9a"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">15</span></p></td><td class="cl-f2bc2f9b"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">1</span></p></td><td class="cl-f2bc2f9c"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">2</span></p></td><td class="cl-f2bc2f9d"><p class="cl-f2bc1fb4"><span class="cl-f2b9b31e">0.8067</span><span class="cl-f2b9b31e"> × (14÷15)</span></p></td><td class="cl-f2bc2f9e"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0.7529</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-f2bc2f91"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">13</span></p></td><td class="cl-f2bc2f9a"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">12</span></p></td><td class="cl-f2bc2f9b"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">1</span></p></td><td class="cl-f2bc2f9c"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">1</span></p></td><td class="cl-f2bc2f9d"><p class="cl-f2bc1fb4"><span class="cl-f2b9b31e">0.7529</span><span class="cl-f2b9b31e"> × (11÷12)</span></p></td><td class="cl-f2bc2f9e"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0.6902</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-f2bc2f91"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">16</span></p></td><td class="cl-f2bc2f9a"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">11</span></p></td><td class="cl-f2bc2f9b"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">1</span></p></td><td class="cl-f2bc2f9c"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0</span></p></td><td class="cl-f2bc2f9d"><p class="cl-f2bc1fb4"><span class="cl-f2b9b31e">0.6902</span><span class="cl-f2b9b31e"> × (10÷11)</span></p></td><td class="cl-f2bc2f9e"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0.6275</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-f2bc2f91"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">22</span></p></td><td class="cl-f2bc2f9a"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">7</span></p></td><td class="cl-f2bc2f9b"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">1</span></p></td><td class="cl-f2bc2f9c"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">3</span></p></td><td class="cl-f2bc2f9d"><p class="cl-f2bc1fb4"><span class="cl-f2b9b31e">0.6275</span><span class="cl-f2b9b31e"> × (6÷7)</span></p></td><td class="cl-f2bc2f9e"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0.5378</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-f2bc2fa4"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">23</span></p></td><td class="cl-f2bc2fa5"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">6</span></p></td><td class="cl-f2bc2fa6"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">1</span></p></td><td class="cl-f2bc2fa7"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0</span></p></td><td class="cl-f2bc2fae"><p class="cl-f2bc1fb4"><span class="cl-f2b9b31e">0.5378</span><span class="cl-f2b9b31e"> × (5÷6)</span></p></td><td class="cl-f2bc2faf"><p class="cl-f2bc1faa"><span class="cl-f2b9b31e">0.4482</span></p></td></tr></tbody></table></div>
<p><br></p>
<ul>
<li>연구 시작 지점에서 대상환자수(number at risk, n.risk)는 21명이었고 아직 이벤트가 발생하지 않았으므로(n.event=0) 생존율은 21/21=1. 6주째에 3명에게 이벤트가 발생하여 6주째의 n.risk는 21명이고 이 중 이벤트가 발생한 3명을 제외하고 18명이 생존하였음. 따라서 6주째 생존율은 다음과 같음</li>
</ul>
<p><span class="math display">\[
\hat{S}(6)=1 \times \frac{(21-3)}{21} =1\times \frac{18}{21} =0.8571
\]</span></p>
<ul>
<li>7주째의 number at risk는 6주째에 3명 실패(이벤트 발생), 1명 중도절단되어 17명이고 생존율은 <span class="math inline">\(0.8571 \times (16/17)=0.8067\)</span>로 추정</li>
</ul>
<p><span class="math display">\[
\hat{S}(7)=1\times \frac{18}{21}\times \frac{16}{17}
\]</span></p>
<ul>
<li>13주째의 생존율</li>
</ul>
<p><span class="math display">\[
\hat{S}(13)=1\times \frac{18}{21}\times \frac{16}{17} \times \frac{14}{15} \times \frac{11}{12} = 0.6902
\]</span></p>
<ul>
<li>이를 이용하여 생존율 그래프를 그릴 수 있으며, 그래프에서 생존율이 0.5인 시간이 median survival을 의미</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="chapter2.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">35</span>), <span class="at">mark.time=</span>T, <span class="at">col=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb22-2"><a href="chapter2.html#cb22-2" aria-hidden="true" tabindex="-1"></a>median<span class="ot">=</span>fit<span class="sc">$</span>time[<span class="fu">min</span>(<span class="fu">which</span>(fit<span class="sc">$</span>surv<span class="sc">&lt;</span><span class="fl">0.5</span>))]</span>
<span id="cb22-3"><a href="chapter2.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="dv">0</span>,<span class="fl">0.5</span>,median,<span class="fl">0.5</span>,<span class="at">angle=</span><span class="dv">15</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb22-4"><a href="chapter2.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(median,<span class="fl">0.5</span>,median,<span class="dv">0</span>,<span class="at">angle=</span><span class="dv">15</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb22-5"><a href="chapter2.html#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(median,<span class="fl">0.02</span>,median,<span class="at">pos=</span><span class="dv">1</span>,<span class="at">offset=</span><span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="Survival-Analysis_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<ul>
<li>survminer 패키지의 ggsurvplot()을 이용하면 보다 보기 좋은 그래프를 얻을 수 있음</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="chapter2.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb23-2"><a href="chapter2.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit,<span class="at">data=</span>data, <span class="at">risk.table=</span>T)</span></code></pre></div>
<p><img src="Survival-Analysis_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<ul>
<li>앞에서 편의상 치료군만을 대상으로 하였으나, 치료군/대조군 모두에서 생존율을 구하면 다음과 같음</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="chapter2.html#cb24-1" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx,<span class="at">data=</span>anderson1)</span>
<span id="cb24-2"><a href="chapter2.html#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="chapter2.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(time, status) ~ rx, data = anderson1)
## 
##                 rx=Treatment 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     6     21       3    0.857  0.0764        0.720        1.000
##     7     17       1    0.807  0.0869        0.653        0.996
##    10     15       1    0.753  0.0963        0.586        0.968
##    13     12       1    0.690  0.1068        0.510        0.935
##    16     11       1    0.627  0.1141        0.439        0.896
##    22      7       1    0.538  0.1282        0.337        0.858
##    23      6       1    0.448  0.1346        0.249        0.807
## 
##                 rx=Control 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     1     21       2   0.9048  0.0641      0.78754        1.000
##     2     19       2   0.8095  0.0857      0.65785        0.996
##     3     17       1   0.7619  0.0929      0.59988        0.968
##     4     16       2   0.6667  0.1029      0.49268        0.902
##     5     14       2   0.5714  0.1080      0.39455        0.828
##     8     12       4   0.3810  0.1060      0.22085        0.657
##    11      8       2   0.2857  0.0986      0.14529        0.562
##    12      6       2   0.1905  0.0857      0.07887        0.460
##    15      4       1   0.1429  0.0764      0.05011        0.407
##    17      3       1   0.0952  0.0641      0.02549        0.356
##    22      2       1   0.0476  0.0465      0.00703        0.322
##    23      1       1   0.0000     NaN           NA           NA</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="chapter2.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit)</span></code></pre></div>
<p><img src="Survival-Analysis_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div id="censoring에-대한-논의" class="section level4 hasAnchor" number="2.1.2.1">
<h4><span class="header-section-number">2.1.2.1</span> Censoring에 대한 논의<a href="chapter2.html#censoring에-대한-논의" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Original data</li>
</ol>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="chapter2.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Original data</span></span>
<span id="cb27-2"><a href="chapter2.html#cb27-2" aria-hidden="true" tabindex="-1"></a>fit1<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>data)</span>
<span id="cb27-3"><a href="chapter2.html#cb27-3" aria-hidden="true" tabindex="-1"></a>fit1</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(time, status) ~ 1, data = data)
## 
##       n events median 0.95LCL 0.95UCL
## [1,] 21      9     23      16      NA</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Censoring 제거</li>
</ol>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="chapter2.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Censoring 제거</span></span>
<span id="cb29-2"><a href="chapter2.html#cb29-2" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span><span class="fu">subset</span>(data,status<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb29-3"><a href="chapter2.html#cb29-3" aria-hidden="true" tabindex="-1"></a>fit2</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(time, status) ~ 1, data = subset(data, 
##     status == 1))
## 
##      n events median 0.95LCL 0.95UCL
## [1,] 9      9     10       6      NA</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Time point 9와 10을 censoring에서 event로 변경</li>
</ol>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="chapter2.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># time=9, 10 에서 censoring을 event로 변경</span></span>
<span id="cb31-2"><a href="chapter2.html#cb31-2" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> index <span class="ot">&lt;-</span> data<span class="sc">$</span>time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">10</span>)</span>
<span id="cb31-3"><a href="chapter2.html#cb31-3" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> data</span>
<span id="cb31-4"><a href="chapter2.html#cb31-4" aria-hidden="true" tabindex="-1"></a>data2<span class="sc">$</span>status[index] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb31-5"><a href="chapter2.html#cb31-5" aria-hidden="true" tabindex="-1"></a>fit3<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>data2)</span>
<span id="cb31-6"><a href="chapter2.html#cb31-6" aria-hidden="true" tabindex="-1"></a>fit3</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(time, status) ~ 1, data = data2)
## 
##       n events median 0.95LCL 0.95UCL
## [1,] 21     11     22      10      NA</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="chapter2.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">0</span>,fit1<span class="sc">$</span>time), <span class="fu">c</span>(<span class="dv">1</span>,fit1<span class="sc">$</span>surv), <span class="at">type=</span><span class="st">&quot;s&quot;</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">35</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">xlab=</span><span class="st">&quot;Time&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Survival Probability&quot;</span>)</span>
<span id="cb33-2"><a href="chapter2.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>,fit2<span class="sc">$</span>time), <span class="fu">c</span>(<span class="dv">1</span>,fit2<span class="sc">$</span>surv), <span class="at">type=</span><span class="st">&quot;s&quot;</span>,<span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb33-3"><a href="chapter2.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>,fit3<span class="sc">$</span>time), <span class="fu">c</span>(<span class="dv">1</span>,fit3<span class="sc">$</span>surv), <span class="at">type=</span><span class="st">&quot;s&quot;</span>,<span class="at">col=</span><span class="dv">3</span>)</span>
<span id="cb33-4"><a href="chapter2.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">25</span>,<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">&quot;Original&quot;</span>,<span class="st">&quot;No Censoring&quot;</span>,<span class="st">&quot;Mutation&quot;</span>),<span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="Survival-Analysis_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
</div>
<div id="sas-예제" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> SAS 예제<a href="chapter2.html#sas-예제" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Kaplan Meier estimator for the 6 MP data</li>
</ul>
<pre><code>data one;
input time censor @@;
cards;
6 1 6 1 6 1 7 1 10 1 13 1 16 1
22 1 23 1 6 0 9 0 10 0 11 0 17 0
19 0 20 0 25 0 32 0 32 0 34 0 35 0
;
run;

proc sort data=one; by time censor; run;
proc print data=one; run;</code></pre>
<p><img src="survival_add/sas1.png" /></p>
<pre><code>proc lifetest method=KM plots=(S) graphics outsurv=a;
time time*censor(0);
symbol1 v=none;
run;</code></pre>
<p><img src="survival_add/sas2.png" /></p>
<p><img src="survival_add/sas3.png" /></p>
<p><img src="survival_add/sas4.png" /></p>
<pre><code>proc print data=a; run;</code></pre>
<p><img src="survival_add/sas5.png" /></p>
<blockquote>
<blockquote>
<p>Note</p>
</blockquote>
</blockquote>
<p>To get confidence intervals around the survival probabilities, you can do using the OUTSURV=option in the PROC LIFETEST option.</p>
<ul>
<li><p>OUTSURV= Data Set</p>
<ul>
<li>You can specify either the OUTSURV= option in the PROC LIFETEST statement to create an output data set containing the following columns:</li>
</ul></li>
<li><p>any specified BY variables</p></li>
<li><p>any specified STRATA variables, their values coming from either their original values or the midpoints of the stratum intervals if endpoints are used to define strata (semi-infinite intervals are labeled by their finite endpoint)</p></li>
<li><p>STRATUM, a numeric variable that numbers the strata</p></li>
<li><p>the time variable as given in the TIME statement. In the case of the product-limit estimates, it contains the observed failure or censored times. For the life-table estimates, it contains the lower endpoints of the time intervals.</p></li>
<li><p>SURVIVAL, a variable containing the survivor function estimates</p></li>
<li><p>CONFTYPE, a variable containing the name of the transformation applied to the survival time in the computation of confidence intervals (if the OUT= option is specified in the SURVIVAL statement)</p></li>
<li><p>SDF_LCL, a variable containing the lower limits of the pointwise confidence intervals for the survivor function</p></li>
<li><p>SDF_UCL, a variable containing the upper limits of the pointwise confidence intervals for the survivor function
If the estimation uses the product-limit method, then the data set also contains</p></li>
<li><p><em>CENSOR</em>, an indicator variable that has a value 1 for a censored observation and a value 0 for an event observation
If the estimation uses the life-table method, then the data set also contains</p></li>
<li><p>MIDPOINT, a variable containing the value of the midpoint of the time interval</p></li>
<li><p>PDF, a variable containing the density function estimates</p></li>
<li><p>PDF_LCL, a variable containing the lower endpoint of the PDF confidence interval</p></li>
<li><p>PDF_UCL, a variable containing the upper endpoint of the PDF confidence interval</p></li>
<li><p>HAZARD, a variable containing the hazard estimates</p></li>
<li><p>HAZ_LCL, a variable containing the lower endpoint of the hazard confidence interval</p></li>
<li><p>HAZ_UCL, a variable containing the upper endpoint of the hazard confidence interval</p></li>
<li><p>Each survival function contains an initial observation with the value 1 for the SDF and the value 0 for the time. The output data set contains an observation for each distinct failure time if the product-limit method is used or an observation for each time interval if the life-table method is used. The product-limit survival estimates are defined to be right continuous; that is, the estimates at a given time include the factor for the failure events that occur at that time.</p></li>
<li><p>Labels are assigned to all the variables in the output data set except the BY variable and the STRATA variable.</p></li>
<li><p>Myelomatosis data</p>
<ul>
<li>This data gives survival times for 25 patients diagnosed with myelomatosis. These patients were randomly assigned to two drug treatments as indicated by TREAT variable.</li>
<li>DUR: the time in days from the point of randomization to either death or censoring(which could occur either by loss to follow up or termination of the observation).</li>
<li>STATUS: a value of 1 for those who died and 0 for those who were censored</li>
<li>RENAL: indicator variable for normal (1) versus impaired (0) renal functioning at the time of randomization</li>
</ul></li>
</ul>
<pre><code>
data myel;
   input dur status treat renal;
   cards;
8 1 1 1
180 1 2 0
632 1 2 0 
852 0 1 0
52 1 1 1
2240 0 2 0
220 1 1 0
63 1 1 1
195 1 2 0
76 1 2 0
70 1 2 0
8 1 1 0
13 1 2 1
1990 0 2 0
1976 0 1 0
18 1 2 1
700 1 2 0
1296 0 1 0
1460 0 1 0
210 1 2 0
63 1 1 1
1328 0 1 0
1296 1 2 0
365 0 1 0
23 1 2 1
;
run;

proc sort data=myel; by dur status; run;
proc print data=myel; run;</code></pre>
<p><img src="survival_add/sas6.png" /></p>
<pre><code>ods graphics on;
proc lifetest data=myel PLOTS=(S,LS,LLS) graphics;
    time dur*status(0);
    symbol1 v=none;
run;
ods graphics off;</code></pre>
<p><img src="survival_add/sas7.png" /></p>
<p><img src="survival_add/sas8.png" /></p>
<p><img src="survival_add/sas9.png" /></p>
<p><img src="survival_add/sas10.png" /></p>
<p><img src="survival_add/sas11.png" /></p>
<p><br></p>
</div>
</div>
<div id="생명표-방법" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> 생명표 방법<a href="chapter2.html#생명표-방법" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>환자의 수가 상당히 많을 때에는 그들 개개의 생존시간을 고려하는 대신
생존시간을 몇 개의 구간으로 나누어 생존자료를 요약하는 방법이 필요</p></li>
<li><p>보험통계와 같이 데이터의 수집단계에서부터 생존시간이 1년 단위의
구간별로 나뉘어서 주어지는 경우에도 생명표 방법(life table method)이
주로 사용됨</p></li>
<li><p>생존시간을 <span class="math inline">\(k+1\)</span>개의 구간 <span class="math inline">\([t_{i-1}, t_i), \,\,\, i=1, \ldots, k+1\)</span>
으로 나눔. 이 때 <span class="math inline">\(t_0=0\)</span>이고 <span class="math inline">\(t_{k+1}=\infty\)</span></p></li>
<li><p><span class="math inline">\(i\)</span>번째 구간의 시작지점에서의 생존자수를 <span class="math inline">\(n_i\)</span>, <span class="math inline">\(i\)</span>번째 구간에서의
사망자수를 <span class="math inline">\(d_i\)</span>, <span class="math inline">\(c_i\)</span>는 <span class="math inline">\(i\)</span>번째 구간에서 중도절단된 인원수</p></li>
<li><p>구간 내에서의 생존률 <span class="math inline">\(p_i=P\)</span>(<span class="math inline">\(i\)</span>번째 구간에서 내내 생존<span class="math inline">\(|i\)</span>번째
구간의 시작점에서 생존)<span class="math inline">\(=P(T&gt;t_i|T&gt;t_{i-1})\)</span>, 구간 내 사망률은
<span class="math inline">\(q_i = 1-p_i\)</span></p></li>
</ul>
<p><br></p>
<div id="생명표의-형태" class="section level4 unnumbered hasAnchor">
<h4>생명표의 형태<a href="chapter2.html#생명표의-형태" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><img src="survival/d3.jpg" style="width:90.0%" /></p>
<p><br></p>
<ul>
<li><p><span class="math inline">\(i\)</span>번째 구간의 시작시점에서의 인원수(위험그룹인원수) <span class="math inline">\(n_i\)</span>는
<span class="math inline">\(n_i=n_{i-1}-d_{i-1}-c_{i-1}\)</span>이며, 유효인원수(effective sample size)
<span class="math inline">\(n_i&#39;\)</span>는 구간에서의 위험그룹인원수에서 중도절단된 인원수의 <span class="math inline">\(1/2\)</span>을
뺀 <span class="math inline">\(n_i&#39;=n_i-c_i/2\)</span></p></li>
<li><p>중도절단이 발생한 경우에는 그룹내내 위험에 노출된 것이 아니라
절반가량 노출되었다고 생각하여 이와 같이 인원수를 조정</p></li>
<li><p><span class="math inline">\(i\)</span>번째 구간에서의 사망률 <span class="math inline">\(q_i\)</span>의 추정값은 <span class="math inline">\(\hat{q}_i=d_i/n_i&#39;\)</span>,
생존률 <span class="math inline">\(p_i\)</span>의 추정값은 <span class="math inline">\(\hat{p}_i=1-\hat{q}_i=1-d_i/n_i&#39;\)</span></p></li>
<li><p>생존함수</p></li>
</ul>
<p><span class="math display">\[
S(t_i)=P(T&gt;t_i)
            =P(T&gt;t_1)P(T&gt;t_2|T&gt;t_1)\cdots P(T&gt;t_i|T&gt;t_{i-1})
            =p_1p_2\cdots p_i
\]</span></p>
<ul>
<li>생존함수 추정
<span class="math display">\[
\hat{S}(t_i)=\prod_{k=1}^i \hat{p}_{k}=\prod_{k=1}^i(1-d_k/n_k&#39;)
\]</span></li>
</ul>
<p>이 때 <span class="math inline">\(\hat{S}(0)=1\)</span></p>
<ul>
<li><p>그린우드의 공식 (Greenwood formula) - 분산 추정량
<span class="math display">\[
\hat{Var}(\hat{S}(t_i))=\hat{S}^2(t_i)\sum_{k=1}^i \frac{d_k}{n_k&#39;(n_k&#39;-d_k)}
\]</span></p></li>
<li><p><span class="math inline">\(100(1-\alpha)\%\)</span> CI</p></li>
</ul>
<p><span class="math display">\[
\hat{S}(t_i)\pm z_{1-\alpha/2}\sqrt{\hat{Var}(\hat{S}(t_i))}
\]</span></p>
<ul>
<li>Example - Survival of patients with particular form of malignant disease</li>
</ul>
<p><img src="survival/ex0.jpg" style="width:90.0%" /></p>
<ul>
<li>Survival curve</li>
</ul>
<p><img src="survival/ex0.png" style="width:90.0%" /></p>
</div>
<div id="sas-예제-1" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> SAS 예제<a href="chapter2.html#sas-예제-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Survival of patients with particular form of malignant disease</li>
</ul>
<pre><code>data one;
input year failure number @@;
cards;
0.5 1 90
1.5 1 76
2.5 1 51
3.5 1 25    3.5 0 12
4.5 1 20    4.5 0 5
5.5 1 7     5.5 0 9
6.5 1 4     6.5 0 9
7.5 1 1     7.5 0 3
8.5 1 3     8.5 0 5
9.5 1 2     9.5 0 5
10.5 1 21  10.5 0 26
;
run;

proc print data=one; run;</code></pre>
<p><img src="survival_add/sas12.png" /></p>
<pre><code>proc lifetest method=LT plot=(S)graphics   
      intervals=1,2,3,4,5,6,7,8,9,10;
time year*failure(0);
freq number;
run;</code></pre>
<p><img src="survival_add/sas13.png" /></p>
<p><img src="survival_add/sas14.png" /></p>
<p><br></p>
</div>
</div>
<div id="생존분포-비교" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> 생존분포 비교<a href="chapter2.html#생존분포-비교" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>가정</p>
<ul>
<li>첫 번째 그룹의 생존시간 <span class="math inline">\(T_{11}, T_{12}, \ldots, T_{1n_1}\)</span>은 서로
독립이며 동일한 생존함수 <span class="math inline">\(S_1\)</span>을 갖고, 중도절단 시간
<span class="math inline">\(C_{11}, C_{12}, \ldots, C_{1n_1}\)</span>도 서로 독립이며 동일한 분포함수
<span class="math inline">\(G_1\)</span>을 가짐</li>
<li>마찬가지로 두 번째 그룹의 생존시간
<span class="math inline">\(T_{21}, T_{22}, \ldots, T_{2n_2}\)</span>은 서로 독립이며 동일한 생존함수
<span class="math inline">\(S_2\)</span>을 갖고, 중도절단 시간 <span class="math inline">\(C_{21}, C_{22}, \ldots, C_{2n_2}\)</span>도
서로 독립이며 동일한 분포함수 <span class="math inline">\(G_2\)</span>를 가짐</li>
</ul></li>
<li><p>관측값의 형태</p>
<ul>
<li><p>그룹 1:
<span class="math inline">\((x_{11},\delta_{11}), (x_{12},\delta_{12}), \ldots, (x_{1n_1},\delta_{1n_1})\)</span></p></li>
<li><p>그룹 2:
<span class="math inline">\((x_{21},\delta_{21}), (x_{22},\delta_{22}), \ldots, (x_{2n_1},\delta_{2n_2})\)</span></p>
<p>여기서 <span class="math inline">\(x_{ij}=min(T_{ij},C_{ij})\)</span>이고 <span class="math inline">\(\delta_{ij}\)</span>는 중도절단을
나타내는 가변수(<span class="math inline">\(\delta_{ij}=0\)</span>: 중도절단)</p></li>
</ul></li>
</ul>
<p><br></p>
<div id="특정시점에서의-생존률-비교" class="section level4 unnumbered hasAnchor">
<h4>특정시점에서의 생존률 비교<a href="chapter2.html#특정시점에서의-생존률-비교" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>가설
<span class="math display">\[H_0 : S_1(t_k )= S_2(t_k) \,\,\, vs. \,\,\, H_1 : S_1(t_k) \ne S_2(t_k)\]</span></p></li>
<li><p>검정통계량</p>
<p><span class="math display">\[Z=\frac{\hat{S}_1(t_k)-\hat{S}_2(t_k)}{\sqrt{\hat{Var}(\hat{S}_1(t_k))+\hat{Var}(\hat{S}_2(t_k))}} \sim N(0,1)\]</span></p></li>
</ul>
<p><br></p>
</div>
<div id="생존함수의-총괄적-비교" class="section level4 unnumbered hasAnchor">
<h4>생존함수의 총괄적 비교<a href="chapter2.html#생존함수의-총괄적-비교" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>가설
<span class="math display">\[H_0 : S_1=S_2 \,\,\, vs. \,\,\, H_1 : S_1 \ne S_2\]</span></p></li>
<li><p>두 생존분포의 비교에 주로 사용되는 기법은 Mantel-Haenszel의 로그
순위 검정법(log-rank test)</p></li>
<li><p><span class="math inline">\(t_1 &lt; t_2 &lt; \cdots &lt; t_k\)</span>를 두 그룹의 자료를 섞었을 때 관측된
사망시간을 순서대로 놓은 것이라고 하면, 모든 <span class="math inline">\(t_i\)</span>에서 다음과 같은
<span class="math inline">\(2\)</span>차원 분할표를 작성함</p></li>
</ul>
<p><img src="survival/lo5.jpg" style="width:90.0%" /></p>
<p><br></p>
<ul>
<li><p>검정통계량
<span class="math display">\[T=\frac{\left(  \sum_{i=1}^k (d_{1i}-E_{1i})    \right)^2}{\sum_{i=1}^k V_{1i}} \sim \chi(1)\]</span></p>
<p>여기서 <span class="math inline">\(E(d_{1i})=E_{1i}=n_{1i}d_i/n_i\)</span>,
<span class="math inline">\(Var(d_{i1})=V_{1i}=\frac{n_{1i}n_{2i}}{n_1-1}\frac{d_i(n_i-d_i)}{n_i^2}\)</span></p></li>
<li><p>로그 순위 통계량은 각 시점에서 동일한 비중을 가짐. 따라서 대안으로
다음과 같은 각 시점의 가중치를 다르게 한 통계량을 고려할 수 있음</p></li>
</ul>
<p><span class="math display">\[T=\frac{\left(  \sum_{i=1}^k w_i(d_{1i}-E_{1i})    \right)^2}{\sum_{i=1}^k w_i^2V_{1i}} \sim \chi(1)\]</span></p>
<ul>
<li><p><span class="math inline">\(w=1\)</span>인 경우 로그 순위 통계량이 됨</p></li>
<li><p><span class="math inline">\(w_i=n_i\)</span>이면 Gehan의 검정통계량이 되며, 이때 가중값은 각 시점에서
위험에 처해 있는 인원수에 비례함</p></li>
<li><p>두 그룹의 위험률의 비가 상수일 때 즉, 교차하지 않을 때 로그 순위
검정법이 선호되며, 그렇지 않은 경우에는 다른 가중치를 주는 방법을
선호</p></li>
<li><p><span class="math inline">\(k(\ge 3)\)</span>개의 그룹이 모두 동일한 생존분포를 가지는지 알아내기 위한
검정법도 존재. 크루스칼-왈리스 검정법을 중도절단자료의 경우로
확장시킨 형태와 유사</p></li>
</ul>
<p><br></p>
</div>
<div id="r-예제-1" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> R 예제<a href="chapter2.html#r-예제-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="두-군-간의-km-생존곡선-비교" class="section level4 hasAnchor" number="2.3.1.1">
<h4><span class="header-section-number">2.3.1.1</span> 두 군 간의 KM 생존곡선 비교<a href="chapter2.html#두-군-간의-km-생존곡선-비교" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>로그순위검정(log-rank test)은 2개의 생존곡선이 통계적으로 동등한지를 검정하는 것이며, 2개의 생존곡선을 전체적으로 비교하기 위해 각각의 시간에서 두 군의 기댓값과 관찰값의 차이를 구하여 검정통계량을 계산하는 카이제곱검정의 일종이라고 할 수 있음</p></li>
<li><p>autoReg 패키지의 anderson1 데이터를 예로 검정통계량을 구해보자. 먼저 두 군의 비교를 위해 survfit 함수를 이용</p></li>
</ul>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="chapter2.html#cb41-1" aria-hidden="true" tabindex="-1"></a>fit1<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx,<span class="at">data=</span>anderson1)</span>
<span id="cb41-2"><a href="chapter2.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1)</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(time, status) ~ rx, data = anderson1)
## 
##                 rx=Treatment 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     6     21       3    0.857  0.0764        0.720        1.000
##     7     17       1    0.807  0.0869        0.653        0.996
##    10     15       1    0.753  0.0963        0.586        0.968
##    13     12       1    0.690  0.1068        0.510        0.935
##    16     11       1    0.627  0.1141        0.439        0.896
##    22      7       1    0.538  0.1282        0.337        0.858
##    23      6       1    0.448  0.1346        0.249        0.807
## 
##                 rx=Control 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     1     21       2   0.9048  0.0641      0.78754        1.000
##     2     19       2   0.8095  0.0857      0.65785        0.996
##     3     17       1   0.7619  0.0929      0.59988        0.968
##     4     16       2   0.6667  0.1029      0.49268        0.902
##     5     14       2   0.5714  0.1080      0.39455        0.828
##     8     12       4   0.3810  0.1060      0.22085        0.657
##    11      8       2   0.2857  0.0986      0.14529        0.562
##    12      6       2   0.1905  0.0857      0.07887        0.460
##    15      4       1   0.1429  0.0764      0.05011        0.407
##    17      3       1   0.0952  0.0641      0.02549        0.356
##    22      2       1   0.0476  0.0465      0.00703        0.322
##    23      1       1   0.0000     NaN           NA           NA</code></pre>
<ul>
<li>결과를 보면 치료군 21명 중 23주째의 생존율은 0.448이고, 대조군의 23주째 생존율은 0이다. 두 군 간 생존곡선은 다음과 같음</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="chapter2.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit1,<span class="at">data=</span>anderson1,<span class="at">pval=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Survival-Analysis_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<ul>
<li>그래프에서 보이는 p값이 로그순위검정의 p값으로, 다음과 같은 R 명령어로 구할 수 있음</li>
</ul>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="chapter2.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx,<span class="at">data=</span>anderson1)</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(time, status) ~ rx, data = anderson1)
## 
##               N Observed Expected (O-E)^2/E (O-E)^2/V
## rx=Treatment 21        9     19.3      5.46      16.8
## rx=Control   21       21     10.7      9.77      16.8
## 
##  Chisq= 16.8  on 1 degrees of freedom, p= 4e-05</code></pre>
<ul>
<li>로그순위검정 통계량은 16.8이며 이 통계량은 자유도 1인 카이제곱분포를 따르고 p값은 매우 낮으므로 두 곡선은 동등하지 않다고 할 수 있음</li>
</ul>
<p><br></p>
</div>
<div id="세-군-이상인-경우의-로그순위검정" class="section level4 hasAnchor" number="2.3.1.2">
<h4><span class="header-section-number">2.3.1.2</span> 세 군 이상인 경우의 로그순위검정<a href="chapter2.html#세-군-이상인-경우의-로그순위검정" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>세 군 이상인 경우의 로그순위검정도 survdiff() 함수를 시행할 수 있음</p></li>
<li><p>이때 로그순위검정의 귀무가설은 ’모든 생존곡선이 동등하다’임</p></li>
<li><p>예제로 survival 패키지의 대장암 데이터를 사용하며, stage B/C의 대장암 환자 데이터로 관찰군(Obs)과 Lev, Lev+5FU, 세 군의 생존을 비교함</p></li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="chapter2.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cancer,<span class="at">package=</span><span class="st">&quot;survival&quot;</span>)</span>
<span id="cb46-2"><a href="chapter2.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx,<span class="at">data=</span>colon)</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(time, status) ~ rx, data = colon)
## 
##              N Observed Expected (O-E)^2/E (O-E)^2/V
## rx=Obs     630      345      299      7.01     10.40
## rx=Lev     620      333      295      4.93      7.26
## rx=Lev+5FU 608      242      326     21.61     33.54
## 
##  Chisq= 33.6  on 2 degrees of freedom, p= 5e-08</code></pre>
<ul>
<li>통계량은 33.6(자유도 2)으로 매우 적은 p값을 보임</li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="chapter2.html#cb48-1" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx,<span class="at">data=</span>colon)</span>
<span id="cb48-2"><a href="chapter2.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit2,<span class="at">data=</span>colon,<span class="at">pval=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Survival-Analysis_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="로그순위검정의-대안" class="section level4 hasAnchor" number="2.3.1.3">
<h4><span class="header-section-number">2.3.1.3</span> 로그순위검정의 대안<a href="chapter2.html#로그순위검정의-대안" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>로그순위검정의 대안으로 여러 가지 통계적인 방법들이 제안됨</p></li>
<li><p>이 방법들은 통계량을 구할 때 가중치가 주어짐</p></li>
</ul>
<p><span class="math display">\[T=\frac{\left(  \sum_{i=1}^k w_i(d_{1i}-E_{1i})    \right)^2}{\sum_{i=1}^k w_i^2V_{1i}} \sim \chi(1)\]</span></p>
<ul>
<li><p>Wilcoxon, Tarone-Ware, Peto, Flemington-Harrington 검정등이 알려져 있으며, 방법에 따라 초기 실패에 더 가중치를 주기도 함</p></li>
<li><p>가중값에 따른 검정방법</p></li>
</ul>
<table>
<thead>
<tr class="header">
<th align="center">Test Statistic</th>
<th align="center">가중값</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Log rank</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">Wilcoxon</td>
<td align="center"><span class="math inline">\(n_i\)</span></td>
</tr>
<tr class="odd">
<td align="center">Tarone-Ware</td>
<td align="center"><span class="math inline">\(\sqrt{n_i}\)</span></td>
</tr>
<tr class="even">
<td align="center">Peto</td>
<td align="center"><span class="math inline">\(s(t_i)\)</span></td>
</tr>
<tr class="odd">
<td align="center">Flemington-Harrington</td>
<td align="center"><span class="math inline">\(S(t_i )^p \times (1-S(t_i ))^q\)</span></td>
</tr>
</tbody>
</table>
<ul>
<li><p>pancreatic2 데이터는 췌장암 환자의 생존에 관한 데이터로 asaur 패키지에 포함되어 있음</p></li>
<li><p>데이터에서 pfs는 병기의 진행이 없는 생존(progression free survival)을 나타내며, 병기에 따른 생존곡선을 비교해보고자 함</p></li>
</ul>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="chapter2.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(pancreatic2,<span class="at">package=</span><span class="st">&quot;asaur&quot;</span>)</span>
<span id="cb49-2"><a href="chapter2.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(pfs)<span class="sc">~</span>stage,<span class="at">data=</span>pancreatic2)</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(pfs) ~ stage, data = pancreatic2)
## 
##           N Observed Expected (O-E)^2/E (O-E)^2/V
## stage=LA  8        8     12.3      1.49      2.25
## stage=M  33       33     28.7      0.64      2.25
## 
##  Chisq= 2.2  on 1 degrees of freedom, p= 0.1</code></pre>
<ul>
<li>로그순위검정에서 국소진행암(locally advanced, LA)과 전이된 암(metastatic, M)의 pfs 생존곡선이 동등하지 않다는 근거는 없다고 할 수 있음</li>
</ul>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="chapter2.html#cb51-1" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(pfs)<span class="sc">~</span>stage,<span class="at">data=</span>pancreatic2)</span>
<span id="cb51-2"><a href="chapter2.html#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="chapter2.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit4, <span class="at">data=</span>pancreatic2, <span class="at">pval=</span>T)</span></code></pre></div>
<p><img src="Survival-Analysis_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<ul>
<li>이 데이터에서 survdiff( ) 함수에 rho=1로 옵션을 주어 검정하면, Peto의 수정방법으로 검정함</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="chapter2.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(pfs)<span class="sc">~</span>stage,<span class="at">data=</span>pancreatic2,<span class="at">rho=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(pfs) ~ stage, data = pancreatic2, rho = 1)
## 
##           N Observed Expected (O-E)^2/E (O-E)^2/V
## stage=LA  8     2.34     5.88     2.128      4.71
## stage=M  33    18.76    15.22     0.822      4.71
## 
##  Chisq= 4.7  on 1 degrees of freedom, p= 0.03</code></pre>
<ul>
<li>검정 결과 p값은 0.03으로 유의함
<ul>
<li>이 검정방법은 초기 생존시간에 가중치를 주기 때문에 국소진행암이 초기 생존에 유리한 것으로 판단됨</li>
<li>생존곡선을 그릴 때 ggsurvplot( )함수의 log.rank.weights 인수를 조절하면 이 값을 그래프에 나타낼 수 있음</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="chapter2.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit4,<span class="at">data=</span>pancreatic2,<span class="at">pval=</span><span class="cn">TRUE</span>,<span class="at">log.rank.weights=</span><span class="st">&quot;S1&quot;</span>)</span></code></pre></div>
<p><img src="Survival-Analysis_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="층화된-로그순위검정" class="section level4 hasAnchor" number="2.3.1.4">
<h4><span class="header-section-number">2.3.1.4</span> 층화된 로그순위검정<a href="chapter2.html#층화된-로그순위검정" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>두 군 간의 생존곡선을 비교할 때, 다른 공변량을 보정해야 할 경우 층화된 비례위험모형을 사용할 수 있으며, 보정할 공변량의 수준이 적을 때는 층화된 로그순위검정을 할 수 있음</p></li>
<li><p>층화된 로그순위검정의 귀무가설은 <span class="math inline">\(H_{0}: h_{0j}(t)=h_{1j(t)} \,\,\,for \,\,\ j=1,2, \cdots ,G\)</span></p></li>
<li><p>이때 두 번째 변수의 각 수준에 대해 스코어 통계량 <span class="math inline">\(U_{0g}\)</span>와 분산 <span class="math inline">\(V_{0g}\)</span>를 계산함</p></li>
<li><p>검정통계량</p></li>
</ul>
<p><span class="math display">\[
\chi^2 = \frac{(\sum_{g=1}^G V_{0g})^2}{\sum_{g=1}^G V_{0g}^2}
\]</span></p>
<ul>
<li><p>치료한 병원, 나이군, 성별 등을 층화할 변수로 사용할 수 있음</p></li>
<li><p>assur 패키지의 pharmcoSmoking은 금연 치료로 패치만을 사용한 군과 복합약물치료를 한 군 간의 재발(다시 흡연)까지 걸린 시간에 관한 데이터</p></li>
</ul>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="chapter2.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(pharmacoSmoking,<span class="at">package=</span><span class="st">&quot;asaur&quot;</span>)</span>
<span id="cb55-2"><a href="chapter2.html#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="chapter2.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(ttr,relapse)<span class="sc">~</span>grp,<span class="at">data=</span>pharmacoSmoking)</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(ttr, relapse) ~ grp, data = pharmacoSmoking)
## 
##                  N Observed Expected (O-E)^2/E (O-E)^2/V
## grp=combination 61       37     49.9      3.36      8.03
## grp=patchOnly   64       52     39.1      4.29      8.03
## 
##  Chisq= 8  on 1 degrees of freedom, p= 0.005</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="chapter2.html#cb57-1" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(ttr,relapse)<span class="sc">~</span>grp,<span class="at">data=</span>pharmacoSmoking)</span>
<span id="cb57-2"><a href="chapter2.html#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="chapter2.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit,<span class="at">data=</span>pharmacoSmoking,<span class="at">pval=</span><span class="cn">TRUE</span>,<span class="at">legend=</span><span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.85</span>))</span></code></pre></div>
<p><img src="Survival-Analysis_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<ul>
<li>이때 나이의 영향을 보정하기 위해 ageGroup2를 사용하여 층화된 로그순위검정을 하면 다음과 같음</li>
</ul>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="chapter2.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(ttr,relapse)<span class="sc">~</span>grp<span class="sc">+</span><span class="fu">strata</span>(ageGroup2),<span class="at">data=</span>pharmacoSmoking)</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(ttr, relapse) ~ grp + strata(ageGroup2), 
##     data = pharmacoSmoking)
## 
##                  N Observed Expected (O-E)^2/E (O-E)^2/V
## grp=combination 61       37     49.1      2.99      7.03
## grp=patchOnly   64       52     39.9      3.68      7.03
## 
##  Chisq= 7  on 1 degrees of freedom, p= 0.008</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="chapter2.html#cb60-1" aria-hidden="true" tabindex="-1"></a>labs<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Comibnation, age 21-49&quot;</span>,<span class="st">&quot;Combination, age 50+&quot;</span>,<span class="st">&quot;patchOnly,</span></span>
<span id="cb60-2"><a href="chapter2.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="st">age 21-49&quot;</span>,<span class="st">&quot;patchOnly,age 50+&quot;</span>)</span>
<span id="cb60-3"><a href="chapter2.html#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="chapter2.html#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(<span class="fu">survfit</span>(<span class="fu">Surv</span>(ttr,relapse)<span class="sc">~</span>grp<span class="sc">+</span><span class="fu">strata</span>(ageGroup2), <span class="at">data=</span>pharmacoSmoking), <span class="at">data=</span>pharmacoSmoking,<span class="at">legend=</span><span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.85</span>),<span class="at">legend.labs=</span>labs,<span class="at">pval=</span>T)</span></code></pre></div>
<p><img src="Survival-Analysis_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
</div>
</div>
<div id="sas-예제-2" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> SAS 예제<a href="chapter2.html#sas-예제-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Example</li>
</ul>
<p><img src="survival_add/sas15.png" /></p>
<pre><code>data one;
   input time censor group @@;
   cards;
  2 1 1  6 0 1   9 1 1  12 1 1  15 1 1 
  5 1 2  9 1 2  10 0 2  14 1 2  20 0 2
   ;
run;

ods graphics on;
proc lifetest method=KM plots=(s) graphics;
   time time*censor(0);
   strata group;
   symbol1 v=none color=black line=1;
   symbol2 v=none color=black line=2;
run;
ods graphics off;</code></pre>
<p><img src="survival_add/sas16.png" /></p>
<p><img src="survival_add/sas17.png" /></p>
<ul>
<li>Log rank test for the 6-MP data</li>
</ul>
<pre><code>data six_mp;
   input time censor group @@;
   cards;
6 1 1  6 1 1  6 1 1  7 1 1  10 1 1  13 1 1  16 1 1
22 1 1  23 1 1  6 0 1  9 0 1  10 0 1  11 0 1  17 0 1
19 0 1  20 0 1  25 0 1  32 0 1  32 0 1  34 0 1  35 0 1
1 1 2  1 1 2  2 1 2  2 1 2  3 1 2  4 1 2  4 1 2  5 1 2   5 1 2    
8 1 2  8 1 2  8 1 2  8 1 2  11 1 2  11 1 2  12 1 2
12 1 2  15 1 2  17 1 2  22 1 2  23 1 2  
;
run;

ods graphics on;
proc lifetest method=KM plots=(s) graphics;
   time time*censor(0);
   strata group;
   symbol1 v=none color=black line=1;
   symbol2 v=none color=black line=2;
run;
ods graphics off;</code></pre>
<p><img src="survival_add/sas18.png" /></p>
<p><img src="survival_add/sas19.png" /></p>
<p><br></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Survival Analysis.pdf", "Survival Analysis.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
